<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../displayToc.js"></script>
<script language="JavaScript" src="../../../tocParas.js"></script>
<script language="JavaScript" src="../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../scineplex.css">
<title>DBD::ODBC::FAQ - Frequently Asked Questions for DBD::ODBC</title>
<link rel="stylesheet" href="../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<script>writelinks('__top__',3);</script>
<h1><a>DBD::ODBC::FAQ - Frequently Asked Questions for DBD::ODBC</a></h1>
<p><a name="__index__"></a></p>


<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#version">VERSION</a></li>
	<li><a href="#questions">QUESTIONS</a></li>
	<ul>

		<li><a href="#how_do_i_read_more_than_n_characters_from_a_memo___blob___long_field">How do I read more than N characters from a Memo | BLOB | LONG field?</a></li>
		<li><a href="#what_is_dbd__odbc">What is DBD::ODBC?</a></li>
		<li><a href="#why_can_t_i_connect">Why can't I connect?</a></li>
		<li><a href="#do_i_need_an_odbc_driver">Do I need an ODBC driver?</a></li>
		<li><a href="#what_is_the_odbc_driver_manager">What is the ODBC driver manager?</a></li>
		<li><a href="#where_do_i_get_an_odbc_driver_manager_for_unix_linux">Where do I get an ODBC driver manager for Unix/Linux?</a></li>
		<li><a href="#how_do_i_access_a_ms_sql_server_database_from_linux_unix">How do I access a MS SQL Server database from Linux/UNIX?</a></li>
		<li><a href="#how_do_i_access_a_ms_access_database_from_linux">How do I access a MS-Access database from Linux?</a></li>
		<li><a href="#almost_all_of_my_tests_for_dbd__odbc_fail__they_complain_about_not_being_able_to_connect_or_the_dsn_is_not_found_">Almost all of my tests for DBD::ODBC fail. They complain about not being able to connect or the DSN is not found.</a></li>
		<li><a href="#i_m_attempting_to_bind_a_long_var_char__or_other_specific_type_">I'm attempting to bind a Long Var char (or other specific type)</a></li>
		<li><a href="#does_dbd__odbc_support_multiple_active_statements">Does DBD::ODBC support Multiple Active Statements?</a></li>
		<li><a href="#why_do_i_get_datetime_field_overflow_when_attempting_to_insert_a">Why do I get &quot;Datetime field overflow&quot; when attempting to insert a</a></li>
		<li><a href="#why_do_my_sql_server_temporary_objects_disappear">Why do my SQL Server temporary objects disappear?</a></li>
		<li><a href="#why_cannot_i_connect_to_my_data_source_on_windows_64">Why cannot I connect to my data source on Windows 64?</a></li>
		<li><a href="#how_do_i_use_dbd__odbc_with_web_servers_under_win32_">How do I use DBD::ODBC with web servers under Win32.</a></li>
		<li><a href="#how_do_i_connect_without_dsn">How do I connect without DSN</a></li>
		<li><a href="#why_do_i_get_data_truncated_error_from_sql_server_when_inserting_with_parameters">Why do I get data truncated error from SQL Server when inserting with parameters?</a></li>
		<li><a href="#why_do_i_get_invalid_value_for_cast_specification__22018__from_sql_server_when_inserting_with_parameters">Why do I get invalid value for cast specification (22018) from SQL Server when inserting with parameters?</a></li>
		<li><a href="#why_do_i_get_strange_results_with_sql_server_and_named_parameters">Why do I get strange results with SQL Server and named parameters?</a></li>
		<li><a href="#why_do_i_get_numeric_value_out_of_range_when_binding_dates_in_oracle">Why do I get &quot;Numeric value out of range&quot; when binding dates in Oracle?</a></li>
		<li><a href="#cwb0111_error_with_system_i_access_odbc_driver">CWB0111 error with System i Access ODBC Driver</a></li>
		<li><a href="#connectionwrite__send____error_and_bind_parameters">&quot;ConnectionWrite (send())&quot; error and bind parameters</a></li>
		<li><a href="#sql_query_length_limited_to_about_65500_characters_in_sql_server_2000">SQL query length limited to about 65500 characters in SQL Server 2000</a></li>
		<li><a href="#hy009__invalid_length_or_pointer_from_sqlite">HY009, &quot;invalid length or pointer&quot; from SQLite</a></li>
		<li><a href="#where_do_i_get_the_lastest_mdac_development_kit">Where do I get the lastest MDAC Development Kit?</a></li>
		<li><a href="#why_does_dbd__odbc_fail_to_compile_with_missing_definitions_for_sqllen_sqlulen">Why does DBD::ODBC fail to compile with missing definitions for SQLLEN/SQLULEN?</a></li>
		<li><a href="#why_do_i_get_errors_with_bound_parameters_and_ms_sql_server">Why do I get errors with bound parameters and MS SQL Server?</a></li>
		<li><a href="#why_does_my_script_pause_for_a_while_whenever_my_statement_handle_is_destroyed__goes_out_of_scope_">Why does my script pause for a while whenever my statement handle is destroyed (goes out of scope)?</a></li>
		<li><a href="#why_does_my_backup_restore_some_other_procedure_in_ms_sql_server_not_complete">Why does my backup/restore/some_other_procedure in MS SQL Server not complete?</a></li>
		<li><a href="#why_do_i_get_the_data_types_ntext_and_varchar_are_incompatible_in_the_equal_to_operator">Why do I get &quot;The data types ntext and varchar are incompatible in the equal to operator&quot;?</a></li>
		<li><a href="#why_are_my_integers_returned_as_decimals">Why are my integers returned as decimals?</a></li>
		<li><a href="#why_does_connect_call_fail_on_ubuntu_with_a_undefined_symbol_sqlxxx_error">Why does Connect call fail on Ubuntu with a &quot;undefined symbol SQLxxx&quot; error?</a></li>
		<li><a href="#why_does_connect_fail_with_option_type_out_of_range">Why does Connect fail with &quot;Option type out of range&quot;</a></li>
		<li><a href="#why_do_i_get_undefined_symbol_my_snprintf">Why do I get undefined symbol my_snprintf?</a></li>
		<li><a href="#why_can_i_appear_to_insert_more_than_255_chrs_into_a_ms_access_text_column_but_when_i_read_them_back_i_only_get_255_chrs">Why can I appear to insert more than 255 chrs into a MS Access text column but when I read them back I only get 255 chrs?</a></li>
		<li><a href="#why_am_i_getting_errors_with_bound_parameters">Why am I getting errors with bound parameters?</a></li>
		<li><a href="#why_do_i_get_data_truncated_errors_with_type_info_and_firebird_odbc_driver">Why do I get data truncated errors with type_info and Firebird ODBC Driver?</a></li>
	</ul>

	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#license">LICENSE</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>DBD::ODBC::FAQ - Frequently Asked Questions for DBD::ODBC</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  <a href="../../../lib/pods/perldoc.html">perldoc</a> DBD::ODBC::FAQ</pre>
<p>
</p>
<hr />
<h1><a name="version">VERSION</a></h1>
<p>($Revision: 14854 $)</p>
<p>
</p>
<hr />
<h1><a name="questions">QUESTIONS</a></h1>
<p>
</p>
<h2><a name="how_do_i_read_more_than_n_characters_from_a_memo___blob___long_field">How do I read more than N characters from a Memo | BLOB | LONG field?</a></h2>
<p>See LongReadLen in the DBI docs.</p>
<p>Example:</p>
<pre>
 <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">LongReadLen</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">20000</span><span class="operator">;</span>
 <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"select long_col from big_table"</span><span class="operator">);</span>
 <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
 <span class="variable">etc</span>
</pre>
<p>
</p>
<h2><a name="what_is_dbd__odbc">What is DBD::ODBC?</a></h2>
<p>
</p>
<h2><a name="why_can_t_i_connect">Why can't I connect?</a></h2>
<p>
</p>
<h2><a name="do_i_need_an_odbc_driver">Do I need an ODBC driver?</a></h2>
<p>
</p>
<h2><a name="what_is_the_odbc_driver_manager">What is the ODBC driver manager?</a></h2>
<p>These, general questions lead to needing definitions.</p>
<dl>
<dt><strong><a name="odbc_driver" class="item">ODBC Driver</a></strong></dt>

<dd>
<p>The ODBC Driver is the driver that the ODBC manager uses to connect
and interact with the RDBMS.  You <strong>DEFINITELY</strong> need this to connect to
any database.  For Win32, they are plentiful and installed with many
applications.  For Linux/Unix, you can find a fairly comprehensive list
at <a href="http://www.unixodbc.org/drivers.html">http://www.unixodbc.org/drivers.html</a>.</p>
</dd>
<dt><strong><a name="odbc_driver_manager" class="item">ODBC Driver Manager</a></strong></dt>

<dd>
<p>The ODBC driver manager is the interface between an ODBC application
(DBD::ODBC in this case) and the ODBC driver. The driver manager
principally provides the ODBC API so ODBC applications may link with a
single shared object (or dll) and be able to talk to a range of ODBC
drivers. At run time the application provides a connection string
which defines the ODBC data source it wants to connect to and this in
turn defines the ODBC driver which will handle this data source. The
driver manager loads the requested ODBC driver and passes all ODBC API
calls on to the driver. In this way, an ODBC application can be built
and distributed without knowing which ODBC driver it will be using.</p>
<p>However, this is a rather simplistic description of what the driver
manager does. The ODBC driver manager also:</p>
<p>* Controls a repository of installed ODBC drivers (on UNIX this is the
file odbcinst.ini).</p>
<p>* Controls a repository of defined ODBC data sources (on UNIX these are
the files odbc.ini and .odbc.ini).</p>
<p>* Provides the ODBC driver APIs (SQLGetPrivateProfileString and
SQLWritePrivateProfileString) to read and write ODBC data source
attributes.</p>
<p>* Handles ConfigDSN which the driver exports to configure data
sources.</p>
<p>* Provides APIs to install and uninstall drivers (SQLInstallDriver).</p>
<p>* Maps ODBC versions e.g. so an ODBC 2.0 application can work with an
ODBC 3.0 driver and vice versa.</p>
<p>* Maps ODBC states between different versions of ODBC.</p>
<p>* Provides a cursor library for drivers which only support
forward-only cursors.</p>
<p>* Provides SQLDataSources and SQLDrivers so an application can find
out what ODBC drivers are installed and what ODBC data sources are
defined.</p>
<p>* Provides an ODBC administrator which driver writers can use to
install ODBC drivers and users can use to define ODBC data sources.</p>
<p>The ODBC Driver Manager is the piece of software which interacts with
the drivers for the application.  It &quot;hides&quot; some of the differences
between the drivers (i.e. if a function call is not supported by a
driver, it 'hides' that and informs the application that the call is
not supported.  DBD::ODBC needs this to talk to drivers.</p>
<p>Under Win32, you usually get the ODBC Driver Manager as part of the
OS.  Under Unix/Linux you may have to find and build the driver
manager yourself. The two main driver managers for Unix are unixODBC
(<a href="http://www.unixodbc.org">http://www.unixodbc.org</a>) and iODBC (<a href="http://www.iodbc.org">http://www.iodbc.org</a>).</p>
<p><strong>It is strongly advised you get an ODBC Driver Manager before trying to
build DBD::ODBC unless you intend linking DBD::ODBC directly with your
driver.</strong></p>
<p>For a reasonable description of ODBC on Unix/Linux see
<a href="http://www.easysoft.com/developer/interfaces/odbc/linux.html">http://www.easysoft.com/developer/interfaces/odbc/linux.html</a></p>
</dd>
<dt><strong><a name="dbd_odbc" class="item">DBD::ODBC</a></strong></dt>

<dd>
<p>DBD::ODBC uses the driver manager to talk to the ODBC driver(s) on
your system.  You need both a driver manager and driver installed and
tested before working with DBD::ODBC.  You need to have a DSN (see
below) configured and <strong>TESTED</strong> before being able to test DBD::ODBC.</p>
</dd>
<dt><strong><a name="dsn" class="item">DSN (Data Source Name)</a></strong></dt>

<dd>
<p>The DSN is a way of referring to a particular driver and database by
any name you wish.  The DSN is usually a key to a list of attributes
the ODBC driver needs to connect to the database (e.g. ip address and
port) but there is always a key which names the driver so the driver
manager knows which driver to use with which data source. Do no
confuse DSNs with ODBC connection strings or DBI's &quot;$data_source&quot; (the
first argument to <a href="../../../lib/DBI/connect.html">connect in the DBI manpage</a>.</p>
<p>The $data_source argument to DBI is composed of 'dbi:DRIVER:something_else'
where DRIVER is the name of the DBD driver you want to use (ODBC of
course for DBD::ODBC). The &quot;something_else&quot; for DBD::ODBC can be a DSN
name or it can be a normal ODBC connection string.</p>
<p>An ODBC connection string consists of attribute/value pairs separated
with semicolons (;). You can replace &quot;something_else&quot; above with a
normal ODBC connection string but as a special case for DBD::ODBC you can
just use the DSN name without the usual ODBC connection string prefix
of &quot;DSN=dsn_name&quot;.</p>
<p>e.g.</p>
<dl>
<dt><strong><a name="dbi_odbc_dsn_fred" class="item">dbi:ODBC:DSN=fred</a></strong></dt>

<dd>
<p>ODBC connection string using fred DSN</p>
</dd>
<dt><strong><a name="dbi_odbc_fred" class="item">dbi:ODBC:fred</a></strong></dt>

<dd>
<p>Same as above (a special case).</p>
</dd>
<dt><strong><a name="dbi_odbc_driver_blah_blah_driver_host_1_2_3_4_port_1000" class="item">dbi:ODBC:Driver={blah blah driver};Host=1.2.3.4;Port=1000;</a></strong></dt>

<dd>
<p>This is known as a DSN-less connection string for obvious reasons.</p>
</dd>
</dl>
</dd>
</dl>
<p>
</p>
<h2><a name="where_do_i_get_an_odbc_driver_manager_for_unix_linux">Where do I get an ODBC driver manager for Unix/Linux?</a></h2>
<p>DBD::ODBC used to come bundled with a driver manager but this became
inconvenient when the driver manager was updated.</p>
<p>The two main ODBC Driver Managers for Unix are unixODBC (<a href="http://www.unixodbc/org">http://www.unixodbc/org</a>) and iODBC (<a href="http://www.iodbc.org">http://www.iodbc.org</a>).</p>
<p>If you are running a packaged Linux like RedHat, Ubuntu, Fedora, Suse
etc etc you'll usually find it packaged with unixODBC and using the
package manager to install it is fairly straight forward. However,
make sure that if the driver manager is split into multiple packages
you install the development package as well as that contains the C
header files required by DBD::ODBC.</p>
<p>If you cannot find an ODBC Driver Manager package for your OS you can
download the source tar files for either of the driver managers above
and build it yourself.</p>
<p>
</p>
<h2><a name="how_do_i_access_a_ms_sql_server_database_from_linux_unix">How do I access a MS SQL Server database from Linux/UNIX?</a></h2>
<p>You have loads of choices (in no particular order):</p>
<p>* using DBI::ProxyServer or DBD::Gofer. You'll need the former if you
  use transactions.</p>
<p>* using a commercial ODBC Driver or bridge like the ones from Easysoft
or Openlink.</p>
<p>* using FreeTDS an open source TDS library which includes an ODBC Driver.</p>
<p>* using DBD::Sybase and Sybase libraries.</p>
<p>
</p>
<h2><a name="how_do_i_access_a_ms_access_database_from_linux">How do I access a MS-Access database from Linux?</a></h2>
<p>There are basically three choices:</p>
<p>* a commericial MS Access ODBC Driver like the one from Easysoft.</p>
<p>* a commercial ODBC Bridge like the ones from Easysoft or OpenLink.</p>
<p>* using mdbtools although as of writing it has not been updated since
June 2004, only provides read access and seems to be a little buggy.</p>
<p>
</p>
<h2><a name="almost_all_of_my_tests_for_dbd__odbc_fail__they_complain_about_not_being_able_to_connect_or_the_dsn_is_not_found_">Almost all of my tests for DBD::ODBC fail. They complain about not being able to connect or the DSN is not found.</a></h2>
<p>Please, please test your configuration of ODBC and driver before
trying to test DBD::ODBC. Most of the time, this stems from the fact
that the DSN (or ODBC) is not configured properly. unixODBC comes with
a small program isql and iODBC comes with odbctest and you should use
these to test your ODBC configuration is working properly first.</p>
<p>
</p>
<h2><a name="i_m_attempting_to_bind_a_long_var_char__or_other_specific_type__and_the_binding_is_not_working_">I'm attempting to bind a Long Var char (or other specific type)
and the binding is not working.</a></h2>
<p>The code I'm using is below:</p>
<pre>
        <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$str</span><span class="operator">,</span> <span class="variable">$DBI::SQL_LONGVARCHAR</span><span class="operator">);</span>
                                 <span class="operator">^^^</span>
</pre>
<p>The problem is that DBI::SQL_LONGVARCHAR is not the same as
$DBI::SQL_LONGVARCHAR and that $DBI::SQL_LONGVARCHAR is an error!</p>
<p>It should be:</p>
<pre>
        <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$str</span><span class="operator">,</span> <span class="variable">DBI::SQL_LONGVARCHAR</span><span class="operator">);</span>
</pre>
<p>
</p>
<h2><a name="does_dbd__odbc_support_multiple_active_statements">Does DBD::ODBC support Multiple Active Statements?</a></h2>
<p>Multiple Active Statements (MAS) are concurrent statements created
from the same database handle which both have pending actions on them
(e.g. they both have executed a select statement but not retrieved all
the available rows yet).</p>
<p>DBD::ODBC does support MAS but whether you can actually use MAS is
down to the ODBC Driver.</p>
<p>By default MS SQL Server did not used to support multiple active
statements if any of them were select statements. You could get around
this (with caution) by changing to a dynamic cursor. There is a &quot;hack&quot;
in DBD::ODBC which can be used to enable MAS but you have to fully
understand the implications of doing so(see
<a href="../../../lib/DBD/ODBC.html#odbc_sql_rowset_size">odbc_SQL_ROWSET_SIZE in the DBD::ODBC manpage</a> and <a href="../../../lib/DBD/ODBC.html#odbc_cursortype">odbc_cursortype in the DBD::ODBC manpage</a>).</p>
<p>In MS SQL Server 2005, there is a new thing called MARS (Multiple
Active Result Sets) which allows multiple active select statements but
it has some nasty implications if you are also doing transactions.  To
enable MARS from DBD::ODBC add &quot;MARS_Connection=Yes&quot; to the connection
string as in:</p>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="string">'dbi:ODBC:DSN=mydsn;MARS_Connection=Yes;'</span><span class="operator">);</span>
</pre>
<p>NOTE: Even though you may be using MS SQL Server 2005 if you are using
MS SQL Server drivers you will need to use the Native Client Driver or
a later MS SQL Server ODBC driver (2008 or later) to use MARS.</p>
<p>For other drivers it depends. I believe various Oracle ODBC drivers do
support multiple active statements as myodbc does.</p>
<p>Think carefully before using multiple active statements. It is
probably not portable and there is nearly always a better way of doing
it.</p>
<p>If anyone wants to report success with a particular driver and
multiple active statements I will collect them here.</p>
<p>Also see <a href="http://www.easysoft.com/developer/languages/perl/multiple-active-statements.html">http://www.easysoft.com/developer/languages/perl/multiple-active-statements.html</a></p>
<p>
</p>
<h2><a name="why_do_i_get_datetime_field_overflow_when_attempting_to_insert_a_date_into_oracle">Why do I get &quot;Datetime field overflow&quot; when attempting to insert a
date into Oracle?</a></h2>
<p>If you are using the Oracle or Microsoft ODBC drivers then you may get
the following error when inserting dates into an Oracle database:</p>
<pre>
  [Oracle][ODBC]Datetime field overflow. (SQL-22008)</pre>
<p>If you do then check v$nls_parameters and v$parameter to see if you are
using a date format containing the RR format. e.g.,</p>
<pre>
  select * from v$nls_parameters where parameter = 'NLS_DATE_FORMAT'
  select * from v$parameter where name = 'nls_date_format'</pre>
<p>If you see a date format like 'DD-MON-RR' (e.g., contains an RR) then
all I can suggest is you change the date format for your session as I
have never been able to bind a date using this format. You can do this
with:</p>
<pre>
  alter session set nls_date_format='YYYY/MM/DD'</pre>
<p>and use any format you like but keep away from 'RR'.</p>
<p>You can find some test code in the file examples/rtcpan_28821.pl which
demonstrates this problem. This was originally a rt.cpan issue which
can be found at <a href="http://rt.cpan.org/Ticket/Display.html?id=28821">http://rt.cpan.org/Ticket/Display.html</a>.</p>
<p>As an aside, if anyone is reading this and can shed some light on the problem
I'd love to hear from you. The technical details are:</p>
<pre>
  create table rtcpan28821 (a date)
  insert into rtcpan28821 values('23-MAR-62') fails</pre>
<p>Looking at the ODBC trace, <code>SQLDescribeParam</code> returns:</p>
<pre>
  data type: 93, SQL_TYPE_TIMESTAMP
  size: 19
  decimal digits: 0
  nullable: 1</pre>
<p>and DBD::ODBC calls SQLBindParameter with:</p>
<pre>
  ValueType: SQL_C_CHAR
  ParameterType: SQL_TYPE_TIMESTAMP
  ColumnSize: 9
  DecimalDigits: 0
  Data: 23-MAR-62
  BufferLength: 9</pre>
<p>
</p>
<h2><a name="why_do_my_sql_server_temporary_objects_disappear">Why do my SQL Server temporary objects disappear?</a></h2>
<p>If you are creating temporary objects (e.g., temporary tables) in
SQL Server you find they have disappeared when you attempt to use
them. Temporary objects only have a lifetime of the session they
are created in but in addition, they cannot be created using
prepare/execute. e.g., the following fails:</p>
<pre>
  <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">'select * into #tmp from mytable'</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="string">'select * from #tmp'</span><span class="operator">);</span>
</pre>
<p>with &quot;Invalid object name '#tmp'&quot;. Your should read
<a href="http://technet.microsoft.com/en-US/library/ms131667.aspx">http://technet.microsoft.com/en-US/library/ms131667.aspx</a> which
basically says <em>Prepared statements cannot be used to create
temporary objects on SQL Server 2000 or later...</em>. The proper way to
avoid this is to use the <a href="../../../lib/pods/perlfunc.html#do"><code>do</code></a> method but if you cannot do that then
you need to add the <a href="../../../lib/DBD/ODBC.html#odbc_exec_direct">odbc_exec_direct in the DBD::ODBC manpage</a> attribute to your prepare as
follows:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">'select * into #tmp from mytable'</span><span class="operator">,</span>
                      <span class="operator">{</span> <span class="string">odbc_exec_direct</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">}</span><span class="operator">);</span>
</pre>
<p>See <a href="../../../lib/DBD/ODBC.html#odbc_exec_direct">odbc_exec_direct in the DBD::ODBC manpage</a>.</p>
<p>
</p>
<h2><a name="why_cannot_i_connect_to_my_data_source_on_windows_64">Why cannot I connect to my data source on Windows 64?</a></h2>
<p>If you are running a 32bit Perl on a 64bit Windows machine you will
need to be aware there are two ODBC administrators and you need to
create your DSNs with the right one. The ODBC Administrator you get to
from Control Panel, Administrative Tools, Data Sources is the 64bit
one and data sources created here will not be visible or useable from
32bit applications. The ODBC administrator you need to use for 32bit
applications can be found at X:\windows\syswow64\odbcad32.exe.</p>
<p>
</p>
<h2><a name="how_do_i_use_dbd__odbc_with_web_servers_under_win32_">How do I use DBD::ODBC with web servers under Win32.</a></h2>
<dl>
<dt><strong><a name="general_commentary_re_web_database_access" class="item">General Commentary re web database access</a></strong></dt>

<dd>
<p>This should be a DBI faq, actually, but this has somewhat of an
Win32/ODBC twist to it.</p>
<p>Typically, the Web server is installed as an NT service or a Windows
95/98 service.  This typically means that the web server itself does
not have the same environment and permissions the web developer does.
This situation, of course, can and does apply to Unix web servers.
Under Win32, however, the problems are usually slightly different.</p>
</dd>
<dt><strong><a name="defining_your_dsn_which_type_should_i_use" class="item">Defining your DSN -- which type should I use?</a></strong></dt>

<dd>
<p>Under Win32 take care to define your DSN as a system DSN, not as a user
DSN.  The system DSN is a &quot;global&quot; one, while the user is local to a
user.  Typically, as stated above, the web server is &quot;logged in&quot; as a
different user than the web developer.  This helps cause the situation
where someone asks why a script succeeds from the command line, but
fails when called from the web server.</p>
</dd>
<dt><strong><a name="defining_your_dsn_careful_selection_of_the_file_itself_is_important" class="item">Defining your DSN -- careful selection of the file itself is important!</a></strong></dt>

<dd>
<p>For file based drivers, rather than client server drivers, the file
path is VERY important.  There are a few things to keep in mind.  This
applies to, for example, MS Access databases.</p>
<p>1) If the file is on an NTFS partition, check to make sure that the Web
<strong>service</strong> user has permissions to access that file.</p>
<p>2) If the file is on a remote computer, check to make sure the Web
<strong>service</strong> user has permissions to access the file.</p>
<p>3) If the file is on a remote computer, try using a UNC path the file,
rather than a X:\ notation.  This can be VERY important as services
don't quite get the same access permissions to the mapped drive letters
<strong>and</strong>, more importantly, the drive letters themselves are GLOBAL to
the machine.  That means that if the service tries to access Z:, the Z:
it gets can depend upon the user who is logged into the machine at the
time.  (I've tested this while I was developing a service -- it's ugly
and worth avoiding at all costs).</p>
<p>Unfortunately, the Access ODBC driver that I have does not allow one to
specify the UNC path, only the X:\ notation.  There is at least one way
around that.  The simplest is probably to use Regedit and go to
(assuming it's a system DSN, of course)
HKEY_LOCAL_USERS\SOFTWARE\ODBC\&quot;YOUR DSN&quot; You will see a few settings
which are typically driver specific.  The important value to change for
the Access driver, for example, is the DBQ value.  That's actually the
file name of the Access database.</p>
</dd>
</dl>
<p>
</p>
<h2><a name="how_do_i_connect_without_dsn">How do I connect without DSN</a></h2>
<p>The ability to connect without a full DSN was introduced in version 0.21.</p>
<p>Example (using MS Access):</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$DSN</span> <span class="operator">=</span> <span class="string">'driver=Microsoft Access Driver(*.mdb);dbq=\\\\cheese\\g$\\perltest.mdb'</span><span class="operator">;</span>
  <span class="keyword">my</span> <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="string">"dbi:ODBC:</span><span class="variable">$DSN</span><span class="string">"</span><span class="operator">,</span> <span class="string">''</span><span class="operator">,</span><span class="string">''</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"</span><span class="variable">$DBI</span><span class="string">::errstr\n"</span><span class="operator">;</span>
</pre>
<p>The above sample uses Microsoft's UNC naming convention to point to
the MSAccess file (\\cheese\g$\perltest.mdb).  The dbq parameter tells
the access driver which file to use for the database.</p>
<p>Example (using MSSQL Server):</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$DSN</span> <span class="operator">=</span> <span class="string">'driver={SQL Server};Server=server_name;database=database_name;uid=user;pwd=password;'</span><span class="operator">;</span>
  <span class="keyword">my</span> <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="string">"dbi:ODBC:</span><span class="variable">$DSN</span><span class="string">"</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"</span><span class="variable">$DBI</span><span class="string">::errstr\n"</span><span class="operator">;</span>
</pre>
<p>
</p>
<h2><a name="why_do_i_get_data_truncated_error_from_sql_server_when_inserting_with_parameters">Why do I get data truncated error from SQL Server when inserting with parameters?</a></h2>
<p>Please see &quot;Why am I getting errors with bound parameters&quot; below which
collects all parameter issues together in one FAQ item.</p>
<p>
</p>
<h2><a name="why_do_i_get_invalid_value_for_cast_specification__22018__from_sql_server_when_inserting_with_parameters">Why do I get invalid value for cast specification (22018) from SQL Server when inserting with parameters?</a></h2>
<p>Please see &quot;Why am I getting errors with bound parameters&quot; below which
collects all parameter issues together in one FAQ item.</p>
<p>
</p>
<h2><a name="why_do_i_get_strange_results_with_sql_server_and_named_parameters">Why do I get strange results with SQL Server and named parameters?</a></h2>
<p>If you are using a MS SQL Server driver and named parameters to
procedures be very careful to use then in the same order they are
defined in the procedure. i.e., if you have a procedure like this:</p>
<pre>
  create procedure test
        @param1 varchar(50),
        @param2 smallint
  as
  begin
  ..
  end</pre>
<p>then ensure if you call it using named parameters you specify them in
the same order they are declared:</p>
<pre>
  exec test @param1=?,@param2=?</pre>
<p>and not</p>
<pre>
  exec test @param2=?,@param1=?</pre>
<p>The reason for this is that all SQL Server drivers we have seen
describe procedures parameters in the order they are declared and
ignore the order they are used in the SQL. If you specify them out of
order DBD::ODBC will get details on p1 which are really for p2
etc. This can lead to data truncation errors and all sorts of other
problems it is impossible for DBD::ODBC to spot or workaround.</p>
<p>
</p>
<h2><a name="why_do_i_get_numeric_value_out_of_range_when_binding_dates_in_oracle">Why do I get &quot;Numeric value out of range&quot; when binding dates in Oracle?</a></h2>
<p>Also see &quot;Why do I get &quot;Datetime field overflow&quot; when attempting to insert a
date into Oracle?&quot;.</p>
<p>Here is some example code binding dates; some work, some don't, see comments.</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
</pre>
<pre>
  <span class="comment"># table is "create table martin (a date, b int)"</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$h</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">q{alter session set nls_date_format='DD-MON-YY'}</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q{select * from v$nls_parameters where parameter = 'NLS_DATE_FORMAT'}</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="keyword">print</span> <span class="variable">DBI::dump_results</span><span class="operator">(</span><span class="variable">$s</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$date</span> <span class="operator">=</span> <span class="string">'30-DEC-99'</span><span class="operator">;</span>
  <span class="keyword">my</span> <span class="variable">$dateodbc</span> <span class="operator">=</span> <span class="string">qq/{ d '1999-12-30'}/</span><span class="operator">;</span>
</pre>
<pre>
  <span class="comment"># the following works ok - resulting in 2099-12-30 being inserted</span>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">qq{insert into martin values ('</span><span class="variable">$date</span><span class="string">', 1)}</span><span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># the following works resulting in 1999-12-30 being inserted</span>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">qq{insert into martin values (</span><span class="variable">$dateodbc</span><span class="string">, 2)}</span><span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># fails</span>
  <span class="keyword">eval</span> <span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q{insert into martin values(?,3)}</span><span class="operator">);</span>
      <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$date</span><span class="operator">);</span>
      <span class="comment"># fails</span>
      <span class="comment"># Numeric value out of range: invalid character in date/time string (SQL-22003)</span>
      <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="operator">};</span>
</pre>
<pre>
  <span class="comment"># works resulting in 2099-12-30 being inserted</span>
  <span class="keyword">eval</span> <span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q{insert into martin values(?,4)}</span><span class="operator">);</span>
      <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$date</span><span class="operator">,</span> <span class="variable">DBI::SQL_VARCHAR</span><span class="operator">);</span>
      <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="operator">};</span>
</pre>
<pre>
  <span class="comment"># works resulting in 1999-12-30 being inserted</span>
  <span class="keyword">eval</span> <span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q{insert into martin values(?,5)}</span><span class="operator">);</span>
      <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$dateodbc</span><span class="operator">);</span>
      <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="operator">};</span>
</pre>
<p>In general, when using an ODBC driver you should use the ODBC syntax
for dates, times and timestamps as those are the only formats an ODBC
has to support.</p>
<p>In the above case with Oracle, the date parameter is described as a
SQL_TYPE_DATE SQL type so by default DBD::ODBC binds your parameter as
a SQL_TYPE_DATE. If you use '30-DEC-99' then that means the C type is
SQL_CHAR and the SQL type is SQL_TYPE_DATE so the driver is forced to
parse the date before sending it to Oracle (that would mean knowing
what your NLS_DATE_FORMAT is and it would also mean knowing all the
magic special characters Oracle can use to define date formats).</p>
<p>If you override the bind type to SQL_VARCHAR then the driver sees
SQL_CHAR =&gt; SQL_VARCHAR, nothing to do and hence Oracle itself does
the translation - that is why the SQL_VARCHAR works.</p>
<p>
</p>
<h2><a name="cwb0111_error_with_system_i_access_odbc_driver">CWB0111 error with System i Access ODBC Driver</a></h2>
<p>The full error this relates to is:</p>
<p>[unixODBC][IBM][System i Access ODBC Driver]Column 1: CWB0111 - A buffer passed to a system call is too small to hold return data (SQL-22018)</p>
<p>The iSeries ODBC driver looks at your environment and decides that if
you have UTF-8 set it will encode data returned from the database in
UTF-8.</p>
<p>e.g., LC_CTYPE=fr_FR.UTF-8</p>
<p>If you then select data from your database containing non-ASCII
characters e.g., accented characters the iSeries ODBC driver will
encode the data in UTF-8. UTF-8 encoding increases the size of strings
containing characters with codes &gt; 127.</p>
<p>DBD::ODBC uses SQLDescribeCol and SQLColAttribute ODBC calls to work
out the size of the columns you are retrieving and allocate space for
them. As the ODBC API specifies the sizes returned are on bytes when
the driver says a string column is N is size DBD::ODBC allocates N+1
(for NULL) bytes. If the driver then encodes N characters in UTF-8 the
size will be too big to fit into DBD::ODBC's buffer and you will get
the error above. This is most often seen with char(N) columns as the
trailing spaces are returned by the driver so you are bound to
overflow the buffer as soon as a non-ASCII characters is found.</p>
<p>What are your possible solutions?</p>
<p>You can attempt to trim the data to leave room for the encoding.
e.g., RTRIM(column_name) in your select on char(N) columns but this is
a poor choice and only going to work in a few circumstances.</p>
<p>You can increase the sizes of your columns in the database but this is
another hack.</p>
<p>You can rearrange your SQL to cast the columns in question to larger
types.</p>
<p>Remove UTF-8 from your locale. This is the best solution as it is
guaranteed to stop this error but if you have data which cannot be
represented in 8 bit characters this won't help.</p>
<p>
</p>
<h2><a name="connectionwrite__send____error_and_bind_parameters">&quot;ConnectionWrite (send())&quot; error and bind parameters</a></h2>
<p>The following error can happen when using more than 2097 bind
parameters in a single query with SQL Server 2000:</p>
<pre>
 [Microsoft][ODBC SQL Server Driver][DBNETLIB]ConnectionWrite (send()).
 (SQL-01000) [state was 01000 now 08S01]
 [Microsoft][ODBC SQL Server Driver][DBNETLIB]General network error.
 Check your network documentation. (SQL-08S01)</pre>
<p>This error is most likely due to a bug in the Microsoft SQL Server
ODBC driver as it fails for some versions of the driver and not
others. It is known to fail for version 2000.85.1132.00</p>
<p>See bug report <a href="https://rt.cpan.org/Public/Bug/Display.html?id=49061">https://rt.cpan.org/Public/Bug/Display.html?id=49061</a>
for more details.</p>
<p>
</p>
<h2><a name="sql_query_length_limited_to_about_65500_characters_in_sql_server_2000">SQL query length limited to about 65500 characters in SQL Server 2000</a></h2>
<p>When using bind parameters and a query longer than about 65500
characters the query will fail with some versions of the SQL Server
2000 ODBC driver. The error message from the server can vary. Below is
an example:</p>
<pre>
 [Microsoft][ODBC SQL Server Driver][SQL Server]Invalid column name
 'TES[...]P1I'. (SQL-42S22) [state was 42S22 now 42000]
 [Microsoft][ODBC SQL Server Driver][SQL Server]Statement(s) could not
 be prepared. (SQL-42000)</pre>
<p>Removing the use of binding will allow queries that are longer than
65500 characters.</p>
<p>This bug is known to affect Microsoft SQL Server ODBC driver version
2000.85.1132.00.</p>
<p>See bug report <a href="https://rt.cpan.org/Public/Bug/Display.html?id=49065">https://rt.cpan.org/Public/Bug/Display.html?id=49065</a></p>
<p>
</p>
<h2><a name="hy009__invalid_length_or_pointer_from_sqlite">HY009, &quot;invalid length or pointer&quot; from SQLite</a></h2>
<p>See rt 52651 at <a href="http://rt.cpan.org/Public/Bug/Display.html?id=52651.">http://rt.cpan.org/Public/Bug/Display.html?id=52651.</a></p>
<p>During connection if you get a HY009 &quot;invalid length or pointer&quot; error
it is a bug in SQLSetConnectAttr in SQLite and you will need a version
at least 0.85pre1.</p>
<p>
</p>
<h2><a name="where_do_i_get_the_lastest_mdac_development_kit">Where do I get the lastest MDAC Development Kit?</a></h2>
<p>MS keep moving this around. If you want to build DBD::ODBC yourself
from source you'll need the latest Microsoft Data Access Components
(MDAC) Software Development Kit. You can get it as part of the Platform
Development Kit, with some of the Visual Studio versions and occassionally
from:</p>
<p><a href="http://msdn.microsoft.com/en-us/data/aa937730.aspx">http://msdn.microsoft.com/en-us/data/aa937730.aspx</a></p>
<p>where in April 2010 it listed the &quot;Microsoft Data Access Componetns (MDAC)
2.8 Software Development Kit.</p>
<p>
</p>
<h2><a name="why_does_dbd__odbc_fail_to_compile_with_missing_definitions_for_sqllen_sqlulen">Why does DBD::ODBC fail to compile with missing definitions for SQLLEN/SQLULEN?</a></h2>
<p>This happens because Microsoft changed their headers to add SQLLEN/SQLULEN
types and your C headers are probably out of date. As DBD::ODBC needs
to use these types you'll need an updated MDAC Development Kit. See
&quot; Where do I get the lastest MDAC Development Kit?&quot;.</p>
<p>
</p>
<h2><a name="why_do_i_get_errors_with_bound_parameters_and_ms_sql_server">Why do I get errors with bound parameters and MS SQL Server?</a></h2>
<p>See the question &quot;Why do I get data truncated error from SQL Server
when inserting with parameters?&quot; above. These errors are often because
of bugs in the MS SQL Server ODBC driver in its SQLBindParameter
implementation and can be worked around by specifying a type at bind
time.</p>
<p>e.g.,</p>
<p>Instead of:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">prepare</span><span class="operator">(</span><span class="string">q/some sql with parameters/</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$param1</span><span class="operator">,</span> <span class="variable">$param2</span><span class="operator">);</span>
</pre>
<p>try:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">prepare</span><span class="operator">(</span><span class="string">q/some sql with parameters/</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$param1</span><span class="operator">,</span> <span class="operator">{</span><span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">SQL_VARCHAR</span><span class="operator">}</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">2</span><span class="operator">,</span> <span class="variable">$param2</span><span class="operator">,</span> <span class="operator">{</span><span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">SQL_VARCHAR</span><span class="operator">}</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
</pre>
<p>See <a href="https://connect.microsoft.com/SQLServer/feedback/details/527188/paramater-datatype-lookup-returns-incorrectly">https://connect.microsoft.com/SQLServer/feedback/details/527188/paramater-datatype-lookup-returns-incorrectly</a> and rt ticket 50852.</p>
<p>
</p>
<h2><a name="why_does_my_script_pause_for_a_while_whenever_my_statement_handle_is_destroyed__goes_out_of_scope_">Why does my script pause for a while whenever my statement handle is destroyed (goes out of scope)?</a></h2>
<p>The symptom is that sometimes when your statement handle goes out of
scope and is hence destroyed your script pauses for a while. If you
are using MS SQL Server and certain MS SQL Server ODBC Drivers this
can happen when you issue a select which would return a lot of rows
but you don't fetch them all.</p>
<p>The problem is that the TDS protocol (normally, without Multiple
Active Statement support, or MARS) sends all the result-set down the
socket until it is consumed by the client end. When your statement
handle is destroyed with pending results the ODBC Driver needs to read
all the results to clear the socket. In reality MS SQL Server will
only write so many rows at a time to the socket depending on its
buffer size and will occasionally look at the socket for new requests
so it is possible for ODBC Drivers which support SQLCancel to reduce
the number of rows sent by using DBI's cancel method. In this way the
statement destruction is speeded up since fewer rows you don't need
are sent.  See DBI's cancel method and if you destroy a statement
handle with pending results, call cancel before destruction.</p>
<p>However, you are best not selecting rows you have no intention of
retrieving.</p>
<p>See cancel_big_fetch.pl in the DBD::ODBC examples dir. NOTE: more recent
MS SQL Server drivers are better in this respect and sometimes the test
script cancel_big_fetch.pl shows no difference.</p>
<p>
</p>
<h2><a name="why_does_my_backup_restore_some_other_procedure_in_ms_sql_server_not_complete">Why does my backup/restore/some_other_procedure in MS SQL Server not complete?</a></h2>
<p>MS SQL Server batches up results in a procedure. A result may be the
output of a print or a select or in some cases even an insert/update
(see SET NOCOUNT ON|OFF). If you attempt to call a procedure using the
<a href="../../../lib/pods/perlfunc.html#do"><code>do</code></a> method and it outputs results (e.g., a print statement saying
the % completed) the procedure probably will not fully
complete. Instead you should do the following:</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-</span><span class="variable">prepare</span><span class="operator">(</span><span class="variable">call</span> <span class="variable">to</span> <span class="keyword">my</span> <span class="variable">procedure</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="keyword">do</span> <span class="operator">{</span>
    <span class="keyword">while</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">@row</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_array</span><span class="operator">())</span> <span class="operator">{</span>
      <span class="comment"># do stuff here</span>
    <span class="operator">}</span>
  <span class="operator">}</span> <span class="keyword">while</span> <span class="operator">(</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">odbc_more_results</span><span class="operator">}</span><span class="operator">);</span>
  <span class="comment"># do not forget to check $sth-&gt;err here if not using RaiseError as</span>
  <span class="comment"># the outer while loop will stop when there are no more results OR</span>
  <span class="comment"># if an error occurs.</span>
</pre>
<p>
</p>
<h2><a name="why_do_i_get_the_data_types_ntext_and_varchar_are_incompatible_in_the_equal_to_operator">Why do I get &quot;The data types ntext and varchar are incompatible in the equal to operator&quot;?</a></h2>
<p>Or &quot;The data types ntext and nvarchar(max) are incompatible in the
equal to operator&quot;.</p>
<p>MS SQL Server does not like equality comparisons with ntext columns.
You can get this error without using any Perl or DBD::ODBC simply by doing:</p>
<pre>
  select * from mytable where ntext_column = 'hello'</pre>
<p>You unfortunately need to change your SQL to:</p>
<pre>
  select * from mytable where CAST(ntext_column AS nvarchar(max)) = 'hello'</pre>
<p>
</p>
<h2><a name="why_are_my_integers_returned_as_decimals">Why are my integers returned as decimals?</a></h2>
<p>If you are using the MS SQL Server ODBC driver and get
integers/booleans back as apparently decimals e.g. 0.00 instead of 0 and
integer primary keys as nn.nn you've probably either:</p>
<dl>
<dt><strong><a name="setup" class="item">enabled regional settings in the ODBC DSN setup (called &quot;use regional settings with outputting...&quot;</a></strong></dt>

<dt><strong><a name="added_regional_yes_to_your_connection_string" class="item">added &quot;Regional=Yes&quot; to your connection string.</a></strong></dt>

<dd>
<p>The MS SQL Server ODBC Driver regional settings are massively flawed
and break lots of applications - turn it off.</p>
</dd>
</dl>
<p>
</p>
<h2><a name="why_does_connect_call_fail_on_ubuntu_with_a_undefined_symbol_sqlxxx_error">Why does Connect call fail on Ubuntu with a &quot;undefined symbol SQLxxx&quot; error?</a></h2>
<p>Sometimes SQLxxx is SQLAllocHandle or SQLFetch but it could almost be
any ODBC API.</p>
<p>Did you build DBD::ODBC against iODBC? Some versions of Ubunutu Linux
seem to install the libiodbc shared object without a libiodbc.so
symbolic link. The key giveaway when you build DBD::ODBC is a warning like
this:</p>
<pre>
  Note (probably harmless): No library found for -liodbc.so</pre>
<p>You can fix this manually by creating a symbolic link something like this:</p>
<pre>
  sudo ln /usr/lib/libiodbc.so.2 /usr/lib/libiodbc.so</pre>
<p>but to be honest this just moved the problem on for me and I've never got
iODBC working on Ubuntu.</p>
<p>I suggest you remove iODBC and installing the unixodbc, unixodbc-dev and
unixodbc-bin packages.</p>
<p>
</p>
<h2><a name="why_does_connect_fail_with_option_type_out_of_range">Why does Connect fail with &quot;Option type out of range&quot;</a></h2>
<p>You are probably setting an ODBC connection option like
odbc_SQL_ROWSET_SIZE in the connect method. The problem is that some
options can be set in ODBC with SQLSetConnectOption but not retrieved
(silly but that is how some of the driver managers work). In the past
this did not matter but a small bug in DBI introduced years ago causes
attribute values to be fetched.</p>
<p>You need to get a DBI release newer than 1.615 or revision 14463 from
the DBI subversion repository. The change was:</p>
<pre>
  <span class="operator">---</span> <span class="variable">dbi</span><span class="operator">/</span><span class="variable">trunk</span><span class="operator">/</span><span class="variable">DBI</span><span class="operator">.</span><span class="variable">pm</span>  <span class="operator">(</span><span class="variable">original</span><span class="operator">)</span>
  <span class="operator">+++</span> <span class="variable">dbi</span><span class="operator">/</span><span class="variable">trunk</span><span class="operator">/</span><span class="variable">DBI</span><span class="operator">.</span><span class="variable">pm</span>  <span class="variable">Thu</span> <span class="variable">Oct</span>  <span class="number">7</span> <span class="number">02</span><span class="operator">:</span><span class="number">45</span><span class="operator">:</span><span class="number">05</span> <span class="number">2010</span>
  <span class="variable">@@</span> <span class="operator">-</span><span class="number">717</span><span class="operator">,</span><span class="number">7</span> <span class="operator">+</span><span class="number">717</span><span class="operator">,</span><span class="number">8</span> <span class="variable">@@</span>
                <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$a</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">delete</span> <span class="variable">$apply</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$a</span><span class="operator">}</span><span class="operator">;</span>
            <span class="operator">}</span>
            <span class="keyword">while</span> <span class="operator">(</span> <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$a</span><span class="operator">,</span> <span class="variable">$v</span><span class="operator">)</span> <span class="operator">=</span> <span class="keyword">each</span> <span class="variable">%$apply</span><span class="operator">)</span> <span class="operator">{</span>
  <span class="operator">-</span>             <span class="keyword">eval</span> <span class="operator">{</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$a</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$v</span> <span class="operator">}</span> <span class="keyword">or</span> <span class="variable">$@</span> <span class="operator">&amp;&amp;</span> <span class="keyword">warn</span> <span class="variable">$@</span><span class="operator">;</span>
  <span class="operator">+</span>             <span class="keyword">eval</span> <span class="operator">{</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$a</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$v</span> <span class="operator">};</span> <span class="comment"># assign in void context to avoid re-FETCH</span>
  <span class="operator">+</span>                <span class="keyword">warn</span> <span class="variable">$@</span> <span class="keyword">if</span> <span class="variable">$@</span><span class="operator">;</span>
            <span class="operator">}</span>
        <span class="operator">}</span>
</pre>
<p>
</p>
<h2><a name="why_do_i_get_undefined_symbol_my_snprintf">Why do I get undefined symbol my_snprintf?</a></h2>
<p>It is my fault. Basically, I changed DBD::ODBC to use Devel::PPPort's
my_snprintf instead of sprintf (for safety) but because of the way DBI
includes ppport.h (as dbipport.h) I cannot override it in DBD::ODBC.
This should now be fixed in DBI but I cannot retrofit it so if you
get this error you need to upgrade DBI to at least version 1.609.
Sorry, some things are as they are.</p>
<p>From DBD::ODBC 1.26_1 a requirement is DBI 1.609 so this should not be
an issue but the 1.24 and 1.25 series DBD::ODBC did not have this
requirement.</p>
<p>
</p>
<h2><a name="why_can_i_appear_to_insert_more_than_255_chrs_into_a_ms_access_text_column_but_when_i_read_them_back_i_only_get_255_chrs">Why can I appear to insert more than 255 chrs into a MS Access text column but when I read them back I only get 255 chrs?</a></h2>
<p>The simple answer is that MS Access only supports 255 characters in a
text column. You can see this if you create a table with a text column
then examine the PRECISION attribute (see DBI) and it returns 255.</p>
<p>Unfortunately some versions of the MS Access ODBC driver silently
truncate the data instead of issuing a data truncation error so you
are not aware of the truncation until you read it back.</p>
<p>Someone pointed out you can insert more than 255 characters into a MS
Access text column with DBD::ADO but I believe if you look at the
column types after creating the table with DBD::ADO the text column is
really a memo column.</p>
<p>
</p>
<h2><a name="why_am_i_getting_errors_with_bound_parameters">Why am I getting errors with bound parameters?</a></h2>
<p>There are various problems with parameter binding in ODBC Drivers most
of them down to bugs in the ODBC drivers. I created this FAQ to try
and bring them all together in one place and other FAQ entries point
at this one as a number of them boil down to a single problem.</p>
<p>DBD::ODBC used to (many many versions ago) bind all parameters as
SQL_VARCHAR and this mostly works because a SQL_VARCHAR can almost
always be converted to any other SQL type. However, because of bugs in
some ODBC drivers, additional SQL types which work in mysterious ways
(like varchar(max) in MS SQL Server) and dates, DBD::ODBC was changed
to ask the ODBC Driver (<code>SQLDescribeParam</code>) about parameters before
binding them.</p>
<p>There are a few things to note first:</p>
<dl>
<dt><strong><a name="default_bind_type" class="item">default bind type</a></strong></dt>

<dd>
<p>Some ODBC Drivers do not support <code>SQLDescribeParam</code> (e.g. freeTDS) and
in those cases DBD::ODBC reverts to its old behaviour of binding
everything as a SQL_VARCHAR or SQL_WVARCHAR (UNICODE build). In some
rare cases the default bind type might not be what you want.</p>
<p>In addition, if <code>SQLDescribeParam</code> is supported but fails the default
bind type is used.</p>
</dd>
<dt><strong><a name="overriding_the_default_bind_type" class="item">overriding the default bind type</a></strong></dt>

<dd>
<p>You can always override the default bind type used when
<code>SQLDescribeParam</code> is not supported using odbc_default_bind_type.</p>
</dd>
<dt><strong><a name="forcing_a_bind_type" class="item">forcing a bind type</a></strong></dt>

<dd>
<p>Sometimes the ODBC Driver can support <code>SQLDescribeParam</code> but get the
answer wrong e.g., &quot;select myfunc(?) where 1 = 1)&quot; often causes a
problem because the parameter does not correspond to a real column in
a table. In these cases you can use odbc_force_bind_type to stop
DBD::ODBC calling <code>SQLDescribeParam</code> and use the specified type
instead. However, adding TYPE =&gt; xxx to the bind_param call is nearly
always better (as it is more specific) and always overrides
odbc_force_bind_type.</p>
</dd>
<dt><strong><a name="specifying_a_bind_type_on_the_bind_param_call" class="item">specifying a bind type on the bind_param call</a></strong></dt>

<dd>
<p>In all cases this overrides anything else that DBD::ODBC might do
and bare in mind parameter bind types set in this way are &quot;sticky&quot; (see
DBI). This is usually the best method unless you prefer to use a
cast in your SQL.</p>
</dd>
</dl>
<p>Now to the specific problems:</p>
<dl>
<dt><strong><a name="data_truncated_error" class="item">data truncated error</a></strong></dt>

<dd>
<p>DBD::ODBC attempts to use the ODBC API <code>SQLDescribeParam</code> to obtain
information about parameters in parameterised SQL. e.g.,</p>
<pre>
  insert into mytable (column1) values(?)</pre>
<p>The <code>?</code> is a parameter marker. You supply the parameter value (in
this case parameter 1) with a call to the <code>bind_param</code> method or by
adding the parameter to the <code>execute</code> method call. When DBD::ODBC
sees the parameter marker in the SQL it will call <code>SQLDescribeParam</code>
to obtain information about the parameter size and type etc (assuming
your ODBC driver supports <code>SQLDescribeParam</code>).</p>
<p>When you call <code>SQLDescribeParam</code> in the MS SQL Server ODBC driver the
driver will scan your SQL attempting to discover the columns in your
database the parameters align with. e.g., in the above case the
parameter to be bound is linked with &quot;column1&quot; so <code>SQLDescribeParam</code>
should return information about &quot;column1&quot;. The SQL Server ODBC driver
finds information about &quot;column1&quot; (in this example) by creating SQL such
as:</p>
<pre>
  select column1 from mytable where 1 = 2</pre>
<p>then looking at the column details. Unfortunately, some SQL confuses
SQL Server and it will generate SQL to find out about your parameters
which examines the wrong columns and on rare occasions it may even
generate totally incorrect SQL. The test case <em class="file">t/rt_39841.t</em>
demonstrates a couple of these.</p>
<p>The upshot of this is that DBD::ODBC is sometimes lied to about
parameters and will then bind your parameters incorrectly. This can lead
to later errors when <code>execute</code> is called. This happens most commonly
when using parameters in SQL with sub-selects. For example:</p>
<pre>
  create table one (a1 integer, a2 varchar(10))
  create table two (b1 varchar(10), b2 varchar(20))</pre>
<pre>
  insert into one values(1, 'aaaaaaaaaa')
  insert into two values('aaaaaaaaaa','bbbbbbbbbbbbbbbbbbbb')</pre>
<pre>
  select b1, (select a2 from one where a2 = b1) from two where b2 = ?</pre>
<pre>
  param 1 bound as 'bbbbbbbbbbbbbbbbbbbb'</pre>
<p>Clearly in this example, the one and only parameter is for two.b2 which
is a varchar(20) but when SQL Server rearranges your SQL to describe
the parameter it issues:</p>
<pre>
  select a2 from one where 1 = 0</pre>
<p>and DBD::ODBC is told the parameter is a VARCHAR(10). In DBD::ODBC
1.17 this would then lead to a data truncation error because parameter
1 would be bound as 'bbbbbbbbbbbbbbbbbbbb' but with a column size of
10 as that is what <code>SQLDescribeParam</code> returned. DBD::ODBC 1.17_1 (and
later) works around this problem for VARCHAR columns because it is
obvious a VARCHAR parameter of length 20 cannot have a column size of
10 so the column size is increased to the length of the parameter.</p>
</dd>
<dt><strong><a name="specification" class="item">invalid value for the cast specification (22018)</a></strong></dt>

<dd>
<p>See the previous item as this follows on from that.</p>
<p>See <a href="http://support.microsoft.com/kb/269011">http://support.microsoft.com/kb/269011</a> on the microsoft web
site for a bug you may have hit.</p>
<p>In Perl the most common reason for this is that you have bound column
data in SQL which does not match the column type in the database and
the ODBC driver cannot perform the necessary conversion. DBD::ODBC
mostly binds all column data as strings and lets the ODBC driver
convert the string to the right column type. If you supply a string
which cannot be converted to the native column type you will get this
error e.g., if you attempt to bind a non-datetime string to a datetime
column or a non-numeric string to a numeric column.</p>
<p>A more difficult error (from that above in the previous item) can
occur when SQL Server describes the parameter as totally the wrong
type. The first example in <em class="file">t/rt_39841.t</em> demonstrates this. SQL
Server describes a VARCHAR parameter as an integer which DBD::ODBC has
little choice to believe but when something like 'bbbbbbbbbb' is bound
as an integer, SQL Server will then return an error like &quot;invalid
value for cast specification&quot;. The only way around this is to
specifically name the parameter type. e.g.,</p>
<pre>
  create table one (a1 integer, a2 varchar(20))
  create table two (b1 double precision, b2 varchar(8))</pre>
<pre>
  insert into one values(1, 'aaaaaaaaaa')
  insert into two values(1, 'bbbbbbbb')</pre>
<pre>
  select b1, ( select a2 from one where a1 = b1 ) from two where b2 = ?</pre>
<pre>
  param 1 bound as 'bbbbbbbbbb'</pre>
<p>Clearly parameter 1 is a <code>varchar(8)</code> but SQL Server rearranges the SQL to:</p>
<pre>
  select a1 from one where 1 = 2</pre>
<p>when it should have run</p>
<pre>
  select b2 from two where 1 = 2</pre>
<p>As a result parameter 1 is described as an integer and this leads to the
problem. To workaround this problem you would need to bind parameter 1
naming the SQL type of the parameter using something like:</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span> <span class="string">qw(:sql_types)</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="string">'bbbbbbbbbb'</span><span class="operator">,</span> <span class="variable">SQL_VARCHAR</span><span class="operator">);</span>
</pre>
<p>as omitting SQL_VARCHAR will cause DBD::ODBC to use the type
<code>SQLDescribeParam</code> returned.</p>
<p>See <a href="https://connect.microsoft.com/SQLServer/feedback/details/527188/paramater-datatype-lookup-returns-incorrectly">https://connect.microsoft.com/SQLServer/feedback/details/527188/paramater-datatype-lookup-returns-incorrectly</a> and rt ticket 50852.</p>
</dd>
<dt><strong><a name="problems_with_named_parameters" class="item">problems with named parameters</a></strong></dt>

<dd>
<p>If you are using a MS SQL Server driver and named parameters to
procedures be very careful to use then in the same order they are
defined in the procedure. i.e., if you have a procedure like this:</p>
<pre>
  create procedure test
        @param1 varchar(50),
        @param2 smallint
  as
  begin
  ..
  end</pre>
<p>then ensure if you call it using named parameters you specify them in
the same order they are declared:</p>
<pre>
  exec test @param1=?,@param2=?</pre>
<p>and not</p>
<pre>
  exec test @param2=?,@param1=?</pre>
<p>The reason for this is that all SQL Server drivers we have seen
describe procedures parameters in the order they are declared and
ignore the order they are used in the SQL. If you specify them out of
order DBD::ODBC will get details on p1 which are really for p2
etc. This can lead to data truncation errors and all sorts of other
problems it is impossible for DBD::ODBC to spot or workaround.</p>
</dd>
<dt><strong><a name="argument_data_type_varchar_is_invalid_for_argument_n_of_xxx_function" class="item">Argument data type varchar is invalid for argument N of xxx function</a></strong></dt>

<dd>
<p>e.g.,</p>
<pre>
  [SQL Server]Argument data type varchar is invalid for argument 2 of dateadd function.</pre>
<p>Some functions need specific argument types and as explained above
some drivers have a lot of difficulties working out parameter types in
function calls.</p>
<p>In this example (also from the DBIx::Class test code) the SQL was like:</p>
<pre>
  SELECT DATEADD(hour, ?, me.date_created) FROM mytable me where me.id = ?</pre>
<p>The second argument to datadd needs to be an integer. There are 2 ways
around this:</p>
<dl>
<dt><strong><a name="bind_parameter_1_as_an_sql_integer" class="item">bind parameter 1 as an SQL_INTEGER</a></strong></dt>

<dt><strong><a name="cast" class="item">CAST(? as integer)</a></strong></dt>

</dl>
</dd>
<dt><strong><a name="other_bugs_in_odbc_drivers_with_parameter_support" class="item">other bugs in ODBC Drivers with parameter support</a></strong></dt>

<dd>
<p>See the question &quot;Why do I get data truncated error from SQL Server
when inserting with parameters?&quot; above. These errors are often because
of bugs in the MS SQL Server ODBC driver in its SQLBindParameter
implementation and can be worked around by specifying a type at bind
time.</p>
<p>e.g.,</p>
<p>Instead of:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">prepare</span><span class="operator">(</span><span class="string">q/some sql with parameters/</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$param1</span><span class="operator">,</span> <span class="variable">$param2</span><span class="operator">);</span>
</pre>
<p>try:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">prepare</span><span class="operator">(</span><span class="string">q/some sql with parameters/</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$param1</span><span class="operator">,</span> <span class="operator">{</span><span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">SQL_VARCHAR</span><span class="operator">}</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">2</span><span class="operator">,</span> <span class="variable">$param2</span><span class="operator">,</span> <span class="operator">{</span><span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">SQL_VARCHAR</span><span class="operator">}</span><span class="operator">);</span>
  <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
</pre>
<p>See <a href="https://connect.microsoft.com/SQLServer/feedback/details/527188/paramater-datatype-lookup-returns-incorrectly">https://connect.microsoft.com/SQLServer/feedback/details/527188/paramater-datatype-lookup-returns-incorrectly</a> and rt ticket 50852.</p>
</dd>
<dt><strong><a name="example_of_where_overriding_parameter_type_is_required" class="item">example of where overriding parameter type is required</a></strong></dt>

<dd>
<p>Here is an example sent to me from someone (wesm) using DBIx::Class
illustrating a problem with bound parameters in a complex bit of SQL
and date columns:</p>
<pre>
    <span class="keyword">use</span> <span class="variable">DBI</span> <span class="string">qw(:sql_types)</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">warnings</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$h</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">();</span>
    
    <span class="keyword">eval</span><span class="operator">{</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">q/DROP TABLE odbctest/</span><span class="operator">)</span> <span class="operator">};</span>
    
    <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">q/CREATE TABLE odbctest (
       id integer NOT NULL IDENTITY (1,1),
       name nvarchar(50) NULL,
       adate date NULL )/</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q/
    set identity_insert odbctest on;
    insert into odbctest
       (id, name, adate)
       values (?,?,?);
    
    set identity_insert odbctest off;
    select scope_identity();
    /</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">$bug</span>
       <span class="operator">=</span> <span class="keyword">undef</span><span class="operator">;</span>        <span class="comment"># fails</span>
       <span class="comment">#= '2011-03-21'; # works</span>
    <span class="keyword">my</span> <span class="variable">@values</span> <span class="operator">=</span> <span class="operator">(</span>
       <span class="operator">[</span> <span class="number">1000</span><span class="operator">,</span>     <span class="number">2000</span><span class="operator">,</span> <span class="operator">]</span><span class="operator">,</span>
       <span class="operator">[</span> <span class="string">'frew'</span><span class="operator">,</span>   <span class="string">'wes'</span><span class="operator">,</span> <span class="operator">]</span><span class="operator">,</span>
       <span class="operator">[</span> <span class="variable">$bug</span><span class="operator">,</span>    <span class="string">'2009-08-10'</span><span class="operator">,</span> <span class="operator">]</span><span class="operator">,</span>
    <span class="operator">);</span>
</pre>
<pre>
    <span class="keyword">my</span> <span class="variable">$i</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span> <span class="keyword">my</span> <span class="variable">$tuple_status</span><span class="operator">;</span>
    <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param_array</span><span class="operator">(</span><span class="variable">$i</span><span class="operator">++,</span> <span class="variable">$_</span><span class="operator">)</span> <span class="keyword">for</span> <span class="variable">@values</span><span class="operator">;</span>
    <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(</span><span class="operator">{</span><span class="string">ArrayTupleStatus</span> <span class="operator">=&gt;</span> <span class="variable">$tuple_status</span><span class="operator">}</span><span class="operator">);</span>
    
    <span class="variable">$s</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q/select * from odbctest where id = ?/</span><span class="operator">);</span>
    <span class="keyword">foreach</span> <span class="operator">(</span><span class="number">1000</span><span class="operator">,</span> <span class="number">2000</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">);</span>
        <span class="keyword">print</span> <span class="variable">DBI::dump_results</span><span class="operator">(</span><span class="variable">$s</span><span class="operator">);</span>
    <span class="operator">}</span>
</pre>
<p>When I first ran this with SQL Server native client (pre native client 10)
on Windows I got</p>
<pre>
    DBD::ODBC::st execute_array failed: [Microsoft][SQL Native Client]Syntax error,  permission violation, or other nonspecific error (SQL-42000) [err was 1 now 2000</pre>
<p>The call to <code>SQLDescribeParam</code> fails because the driver cannot rearrange
the SQL into a select allowing it to identify the column. DBD::ODBC
then falls back on the default parameter bind type and it still
fails. When you switch to the native client 10 driver (newer) it fails
with optional feature not implemented. Now I'm only guessing here but
the date column type was added in SQL Server 2008 and I'm guessing
when it was added they forgot to add something in the driver for full
date support.</p>
<p>If you use native client 10 and change the insert code to:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">@values</span> <span class="operator">=</span> <span class="operator">(</span>
       <span class="operator">[</span> <span class="number">1000</span><span class="operator">,</span>     <span class="number">2000</span><span class="operator">,</span> <span class="operator">]</span><span class="operator">,</span>
       <span class="operator">[</span> <span class="string">'frew'</span><span class="operator">,</span>   <span class="string">'wes'</span><span class="operator">,</span> <span class="operator">]</span><span class="operator">,</span>
       <span class="operator">[</span> <span class="variable">$bug</span><span class="operator">,</span>    <span class="string">'2009-08-10'</span><span class="operator">,</span> <span class="operator">]</span><span class="operator">,</span>
    <span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">@types</span> <span class="operator">=</span> <span class="operator">(</span>
        <span class="variable">SQL_VARCHAR</span><span class="operator">,</span> <span class="variable">SQL_VARCHAR</span><span class="operator">,</span> <span class="variable">SQL_DATE</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">$i</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span> <span class="keyword">my</span> <span class="variable">$tuple_status</span><span class="operator">;</span>
    <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">bind_param_array</span><span class="operator">(</span><span class="variable">$i</span><span class="operator">++,</span> <span class="variable">$_</span><span class="operator">,</span> <span class="operator">{</span><span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">$types</span><span class="operator">[</span><span class="variable">$i</span><span class="operator">-</span><span class="number">2</span><span class="operator">]}</span><span class="operator">)</span> <span class="keyword">for</span> <span class="variable">@values</span><span class="operator">;</span>
    <span class="variable">$s</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(</span><span class="operator">{</span><span class="string">ArrayTupleStatus</span> <span class="operator">=&gt;</span> <span class="variable">$tuple_status</span><span class="operator">}</span><span class="operator">);</span>
</pre>
<p>you workaround the problem.</p>
<p>It is possible when you read this now that DBIx::Class has worked
around this problem.</p>
</dd>
</dl>
<p>
</p>
<h2><a name="why_do_i_get_data_truncated_errors_with_type_info_and_firebird_odbc_driver">Why do I get data truncated errors with type_info and Firebird ODBC Driver?</a></h2>
<p>The Firebird ODBC driver from the open source Firebird project version
02.01.0100 (as reported in ODBC via SQLGetInfo) seems to report the
length of the TYPE_NAME field for types -9 'VARCHAR(x) CHARACTER SET
UNICODE_' and -10 'BLOB SUB_TYPE TEXT CHARACTER SET ' as 34 but then
attempt to write 36 characters to them.</p>
<p>Unfortunately this is an error via DBI and due to the way type_info
is implemented (where it retrieves all the types the first time you
query any type) it stops you querying any type even those which are
not -9 or -10. Unless you need the TYPE_NAME field this should not matter
to you in which case you can set LongTruncOk before retrieving type_info:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$ti</span><span class="operator">;</span>
  <span class="operator">{</span>
    <span class="keyword">local</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">LongTruncOk</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
    <span class="variable">$ti</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">type_info_all</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>You will need to do something similar if you use the statements
attributes like TYPE the first time you use them.</p>
<p>I reported this issue at <a href="http://tracker.firebirdsql.org/browse/ODBC-122.">http://tracker.firebirdsql.org/browse/ODBC-122.</a></p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Parts of this document were written by Tim Bunce,
Jeff Urlwin and Martin J. Evans.</p>
<p>
</p>
<hr />
<h1><a name="license">LICENSE</a></h1>
<p>This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.8.7 or,
at your option, any later version of Perl 5 you may have available.</p>

</body>

</html>
