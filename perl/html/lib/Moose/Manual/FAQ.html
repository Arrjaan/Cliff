<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../displayToc.js"></script>
<script language="JavaScript" src="../../../tocParas.js"></script>
<script language="JavaScript" src="../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../scineplex.css">
<title>Moose::Manual::FAQ - Frequently asked questions about Moose</title>
<link rel="stylesheet" href="../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<script>writelinks('__top__',3);</script>
<h1><a>Moose::Manual::FAQ - Frequently asked questions about Moose</a></h1>
<p><a name="__index__"></a></p>


<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#version">VERSION</a></li>
	<li><a href="#frequently_asked_questions">FREQUENTLY ASKED QUESTIONS</a></li>
	<ul>

		<li><a href="#module_stability">Module Stability</a></li>
		<ul>

			<li><a href="#is_moose_production_ready">Is Moose &quot;production ready&quot;?</a></li>
			<li><a href="#is_moose_s_api_stable">Is Moose's API stable?</a></li>
			<li><a href="#i_heard_moose_is_slow__is_this_true">I heard Moose is slow, is this true?</a></li>
		</ul>

		<li><a href="#constructors">Constructors</a></li>
		<ul>

			<li><a href="#how_do_i_write_custom_constructors_with_moose">How do I write custom constructors with Moose?</a></li>
			<li><a href="#how_do_i_make_non_moose_constructors_work_with_moose">How do I make non-Moose constructors work with Moose?</a></li>
		</ul>

		<li><a href="#accessors">Accessors</a></li>
		<ul>

			<li><a href="#how_do_i_tell_moose_to_use_get_set_accessors">How do I tell Moose to use get/set accessors?</a></li>
			<li><a href="#how_can_i_inflate_deflate_values_in_accessors">How can I inflate/deflate values in accessors?</a></li>
		</ul>

		<li><a href="#method_modifiers">Method Modifiers</a></li>
		<ul>

			<li><a href="#how_can_i_affect_the_values_in____using_before">How can I affect the values in <a href="../../../lib/pods/perlvar.html#__"><code>@_</code></a> using <code>before</code>?</a></li>
			<li><a href="#can_i_use_before_to_stop_execution_of_a_method">Can I use <code>before</code> to stop execution of a method?</a></li>
			<li><a href="#why_can_t_i_see_return_values_in_an_after_modifier">Why can't I see return values in an <code>after</code> modifier?</a></li>
		</ul>

		<li><a href="#type_constraints">Type Constraints</a></li>
		<ul>

			<li><a href="#how_can_i_provide_a_custom_error_message_for_a_type_constraint">How can I provide a custom error message for a type constraint?</a></li>
			<li><a href="#can_i_turn_off_type_constraint_checking">Can I turn off type constraint checking?</a></li>
			<li><a href="#my_coercions_stopped_working_with_recent_moose__why_did_you_break_it">My coercions stopped working with recent Moose, why did you break it?</a></li>
		</ul>

		<li><a href="#roles">Roles</a></li>
		<ul>

			<li><a href="#why_is_build_not_called_for_my_composed_roles">Why is BUILD not called for my composed roles?</a></li>
			<li><a href="#what_are_traits__and_how_are_they_different_from_roles">What are traits, and how are they different from roles?</a></li>
			<li><a href="#can_an_attribute_generated_method__e_g__an_accessor__satisfy_requires">Can an attribute-generated method (e.g. an accessor) satisfy requires?</a></li>
		</ul>

		<li><a href="#moose_and_subroutine_attributes">Moose and Subroutine Attributes</a></li>
		<ul>

			<li><a href="#why_don_t_subroutine_attributes_i_inherited_from_a_superclass_work">Why don't subroutine attributes I inherited from a superclass work?</a></li>
		</ul>

	</ul>

	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#copyright_and_license">COPYRIGHT AND LICENSE</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>Moose::Manual::FAQ - Frequently asked questions about Moose</p>
<p>
</p>
<hr />
<h1><a name="version">VERSION</a></h1>
<p>version 2.0205</p>
<p>
</p>
<hr />
<h1><a name="frequently_asked_questions">FREQUENTLY ASKED QUESTIONS</a></h1>
<p>
</p>
<h2><a name="module_stability">Module Stability</a></h2>
<p>
</p>
<h3><a name="is_moose_production_ready">Is Moose &quot;production ready&quot;?</a></h3>
<p>Yes! Many sites with household names are using Moose to build
high-traffic services. Countless others are using Moose in production.
See <a href="http://www.iinteractive.com/moose/about.html#organizations">http://www.iinteractive.com/moose/about.html#organizations</a> for
a partial list.</p>
<p>As of this writing, Moose is a dependency of several hundred CPAN
modules. <a href="http://cpants.perl.org/dist/used_by/Moose">http://cpants.perl.org/dist/used_by/Moose</a></p>
<p>
</p>
<h3><a name="is_moose_s_api_stable">Is Moose's API stable?</a></h3>
<p>Yes. The sugary API, the one 95% of users will interact with, is
<strong>very stable</strong>. Any changes will be <strong>100% backwards compatible</strong>.</p>
<p>The meta API is less set in stone. We reserve the right to tweak
parts of it to improve efficiency or consistency. This will not be
done lightly. We do perform deprecation cycles. We <em>really</em>
do not like making ourselves look bad by breaking your code.
Submitting test cases is the best way to ensure that your code is not
inadvertently broken by refactoring.</p>
<p>
</p>
<h3><a name="i_heard_moose_is_slow__is_this_true">I heard Moose is slow, is this true?</a></h3>
<p>Again, this one is tricky, so Yes <em>and</em> No.</p>
<p>Firstly, <em>nothing</em> in life is free, and some Moose features do cost
more than others. It is also the policy of Moose to <strong>only charge you
for the features you use</strong>, and to do our absolute best to not place
any extra burdens on the execution of your code for features you are
not using. Of course using Moose itself does involve some overhead,
but it is mostly compile time. At this point we do have some options
available for getting the speed you need.</p>
<p>Currently we provide the option of making your classes immutable as a
means of boosting speed. This will mean a slightly larger compile time
cost, but the runtime speed increase (especially in object
construction) is pretty significant. This can be done with the
following code:</p>
<pre>
  <span class="variable">MyClass</span><span class="operator">-&gt;</span><span class="variable">meta</span><span class="operator">-&gt;</span><span class="variable">make_immutable</span><span class="operator">();</span>
</pre>
<p>
</p>
<h2><a name="constructors">Constructors</a></h2>
<p>
</p>
<h3><a name="how_do_i_write_custom_constructors_with_moose">How do I write custom constructors with Moose?</a></h3>
<p>Ideally, you should never write your own <code>new</code> method, and should use
Moose's other features to handle your specific object construction
needs. Here are a few scenarios, and the Moose way to solve them;</p>
<p>If you need to call initialization code post instance construction,
then use the <code>BUILD</code> method. This feature is taken directly from Perl
6. Every <code>BUILD</code> method in your inheritance chain is called (in the
correct order) immediately after the instance is constructed.  This
allows you to ensure that all your superclasses are initialized
properly as well. This is the best approach to take (when possible)
because it makes subclassing your class much easier.</p>
<p>If you need to affect the constructor's parameters prior to the
instance actually being constructed, you have a number of options.</p>
<p>To change the parameter processing as a whole, you can use the
<code>BUILDARGS</code> method. The default implementation accepts key/value
pairs or a hash reference. You can override it to take positional
args, or any other format</p>
<p>To change the handling of individual parameters, there are
<em>coercions</em> (See the <a href="../../../lib/Moose/Cookbook/Basics/Recipe5.html">the Moose::Cookbook::Basics::Recipe5 manpage</a> for a
complete example and explanation of coercions). With coercions it is
possible to morph argument values into the correct expected
types. This approach is the most flexible and robust, but does have a
slightly higher learning curve.</p>
<p>
</p>
<h3><a name="how_do_i_make_non_moose_constructors_work_with_moose">How do I make non-Moose constructors work with Moose?</a></h3>
<p>Usually the correct approach to subclassing a non-Moose class is
delegation.  Moose makes this easy using the <code>handles</code> keyword,
coercions, and <code>lazy_build</code>, so subclassing is often not the ideal
route.</p>
<p>That said, if you really need to inherit from a non-Moose class, see
<a href="../../../lib/Moose/Cookbook/Basics/Recipe11.html">the Moose::Cookbook::Basics::Recipe11 manpage</a> for an example of how to do it,
or take a look at <a href="../../../lib/Moose/Manual/MooseX.html#moosex__nonmoose">MooseX::NonMoose in the Moose::Manual::MooseX manpage</a>.</p>
<p>
</p>
<h2><a name="accessors">Accessors</a></h2>
<p>
</p>
<h3><a name="how_do_i_tell_moose_to_use_get_set_accessors">How do I tell Moose to use get/set accessors?</a></h3>
<p>The easiest way to accomplish this is to use the <code>reader</code> and
<code>writer</code> attribute options:</p>
<pre>
  <span class="variable">has</span> <span class="string">'bar'</span> <span class="operator">=&gt;</span> <span class="operator">(</span>
      <span class="string">isa</span>    <span class="operator">=&gt;</span> <span class="string">'Baz'</span><span class="operator">,</span>
      <span class="string">reader</span> <span class="operator">=&gt;</span> <span class="string">'get_bar'</span><span class="operator">,</span>
      <span class="string">writer</span> <span class="operator">=&gt;</span> <span class="string">'set_bar'</span><span class="operator">,</span>
  <span class="operator">);</span>
</pre>
<p>Moose will still take advantage of type constraints, triggers, etc.
when creating these methods.</p>
<p>If you do not like this much typing, and wish it to be a default for
your classes, please see <a href="../../../MooseX/FollowPBP.html">the MooseX::FollowPBP manpage</a>. This extension will
allow you to write:</p>
<pre>
  <span class="variable">has</span> <span class="string">'bar'</span> <span class="operator">=&gt;</span> <span class="operator">(</span>
      <span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Baz'</span><span class="operator">,</span>
      <span class="string">is</span>  <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span>
  <span class="operator">);</span>
</pre>
<p>Moose will create separate <code>get_bar</code> and <code>set_bar</code> methods instead
of a single <code>bar</code> method.</p>
<p>If you like <code>bar</code> and <code>set_bar</code>, see
<a href="../../../MooseX/SemiAffordanceAccessor.html">the MooseX::SemiAffordanceAccessor manpage</a>.</p>
<p>NOTE: This <strong>cannot</strong> be set globally in Moose, as that would break
other classes which are built with Moose. You can still save on typing
by defining a new <a href="../../../MyApp/Moose.html">the MyApp::Moose manpage</a> that exports Moose's sugar and then
turns on <a href="../../../MooseX/FollowPBP.html">the MooseX::FollowPBP manpage</a>. See
<a href="../../../lib/Moose/Cookbook/Extending/Recipe4.html">the Moose::Cookbook::Extending::Recipe4 manpage</a>.</p>
<p>
</p>
<h3><a name="how_can_i_inflate_deflate_values_in_accessors">How can I inflate/deflate values in accessors?</a></h3>
<p>Well, the first question to ask is if you actually need both inflate
and deflate.</p>
<p>If you only need to inflate, then we suggest using coercions. Here is
some basic sample code for inflating a <a href="../../../lib/ActiveState/DateTime.html">the DateTime manpage</a> object:</p>
<pre>
  <span class="variable">class_type</span> <span class="string">'DateTime'</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">coerce</span> <span class="string">'DateTime'</span>
      <span class="operator">=&gt;</span> <span class="variable">from</span> <span class="string">'Str'</span>
      <span class="operator">=&gt;</span> <span class="variable">via</span> <span class="operator">{</span> <span class="variable">DateTime::Format::MySQL</span><span class="operator">-&gt;</span><span class="variable">parse_datetime</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">)</span> <span class="operator">};</span>
</pre>
<pre>
  <span class="variable">has</span> <span class="string">'timestamp'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'DateTime'</span><span class="operator">,</span> <span class="string">coerce</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</pre>
<p>This creates a custom type for <a href="../../../lib/ActiveState/DateTime.html">the DateTime manpage</a> objects, then attaches
a coercion to that type. The <code>timestamp</code> attribute is then told
to expect a <code>DateTime</code> type, and to try to coerce it. When a <code>Str</code>
type is given to the <code>timestamp</code> accessor, it will attempt to
coerce the value into a <code>DateTime</code> object using the code in found
in the <code>via</code> block.</p>
<p>For a more comprehensive example of using coercions, see the
<a href="../../../lib/Moose/Cookbook/Basics/Recipe5.html">the Moose::Cookbook::Basics::Recipe5 manpage</a>.</p>
<p>If you need to deflate your attribute's value, the current best
practice is to add an <code>around</code> modifier to your accessor:</p>
<pre>
  <span class="comment"># a timestamp which stores as</span>
  <span class="comment"># seconds from the epoch</span>
  <span class="variable">has</span> <span class="string">'timestamp'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">around</span> <span class="string">'timestamp'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$next</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
</pre>
<pre>
      <span class="keyword">return</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">$next</span> <span class="keyword">unless</span> <span class="variable">@_</span><span class="operator">;</span>
</pre>
<pre>
      <span class="comment"># assume we get a DateTime object ...</span>
      <span class="keyword">my</span> <span class="variable">$timestamp</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="keyword">return</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">$next</span><span class="operator">(</span> <span class="variable">$timestamp</span><span class="operator">-&gt;</span><span class="variable">epoch</span> <span class="operator">);</span>
        <span class="operator">};</span>
</pre>
<p>It is also possible to do deflation using coercion, but this tends to
get quite complex and require many subtypes. An example of this is
outside the scope of this document, ask on #moose or send a mail to
the list.</p>
<p>Still another option is to write a custom attribute metaclass, which
is also outside the scope of this document, but we would be happy to
explain it on #moose or the mailing list.</p>
<p>
</p>
<h2><a name="method_modifiers">Method Modifiers</a></h2>
<p>
</p>
<h3><a name="how_can_i_affect_the_values_in____using_before">How can I affect the values in <a href="../../../lib/pods/perlvar.html#__"><code>@_</code></a> using <code>before</code>?</a></h3>
<p>You can't, actually: <code>before</code> only runs before the main method, and
it cannot easily affect the method's execution.</p>
<p>You similarly can't use <code>after</code> to affect the return value of a
method.</p>
<p>We limit <code>before</code> and <code>after</code> because this lets you write more
concise code. You do not have to worry about passing <a href="../../../lib/pods/perlvar.html#__"><code>@_</code></a> to the
original method, or forwarding its return value (being careful to
preserve context).</p>
<p>The <code>around</code> method modifier has neither of these limitations, but is
a little more verbose.</p>
<p>Alternatively, the <a href="../../../MooseX/Mangle.html">the MooseX::Mangle manpage</a> extension provides the
<code>mangle_args</code> function, which does allow you to affect <a href="../../../lib/pods/perlvar.html#__"><code>@_</code></a>.</p>
<p>
</p>
<h3><a name="can_i_use_before_to_stop_execution_of_a_method">Can I use <code>before</code> to stop execution of a method?</a></h3>
<p>Yes, but only if you throw an exception. If this is too drastic a
measure then we suggest using <code>around</code> instead. The <code>around</code> method
modifier is the only modifier which can gracefully prevent execution
of the main method. Here is an example:</p>
<pre>
    <span class="variable">around</span> <span class="string">'baz'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="variable">$next</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">%options</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
        <span class="keyword">unless</span> <span class="operator">(</span><span class="variable">$options</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">bar</span><span class="operator">}</span> <span class="keyword">eq</span> <span class="string">'foo'</span><span class="operator">)</span> <span class="operator">{</span>
            <span class="keyword">return</span> <span class="string">'bar'</span><span class="operator">;</span>
        <span class="operator">}</span>
        <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">$next</span><span class="operator">(</span><span class="variable">%options</span><span class="operator">);</span>
    <span class="operator">};</span>
</pre>
<p>By choosing not to call the <code>$next</code> method, you can stop the
execution of the main method.</p>
<p>Alternatively, the <a href="../../../MooseX/Mangle.html">the MooseX::Mangle manpage</a> extension provides the
<code>guard</code> function, which will conditionally prevent execution
of the original method.</p>
<p>
</p>
<h3><a name="why_can_t_i_see_return_values_in_an_after_modifier">Why can't I see return values in an <code>after</code> modifier?</a></h3>
<p>As with the <code>before</code> modifier, the <code>after</code> modifier is simply called
<em>after</em> the main method. It is passed the original contents of <a href="../../../lib/pods/perlvar.html#__"><code>@_</code></a>
and <strong>not</strong> the return values of the main method.</p>
<p>Again, the arguments are too lengthy as to why this has to be. And as
with <code>before</code> I recommend using an <code>around</code> modifier instead.  Here
is some sample code:</p>
<pre>
  <span class="variable">around</span> <span class="string">'foo'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$next</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">@args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="variable">@rv</span> <span class="operator">=</span> <span class="variable">$next</span><span class="operator">-&gt;(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">@args</span><span class="operator">);</span>
      <span class="comment"># do something silly with the return values</span>
      <span class="keyword">return</span> <span class="keyword">reverse</span> <span class="variable">@rv</span><span class="operator">;</span>
  <span class="operator">};</span>
</pre>
<p>Alternatively, the <a href="../../../MooseX/Mangle.html">the MooseX::Mangle manpage</a> extension provides the
<code>mangle_return</code> function, which allows modifying the return values
of the original method.</p>
<p>
</p>
<h2><a name="type_constraints">Type Constraints</a></h2>
<p>
</p>
<h3><a name="how_can_i_provide_a_custom_error_message_for_a_type_constraint">How can I provide a custom error message for a type constraint?</a></h3>
<p>Use the <code>message</code> option when building the subtype:</p>
<pre>
  <span class="variable">subtype</span> <span class="string">'NaturalLessThanTen'</span>
      <span class="operator">=&gt;</span> <span class="variable">as</span> <span class="string">'Natural'</span>
      <span class="operator">=&gt;</span> <span class="variable">where</span> <span class="operator">{</span> <span class="variable">$_</span> <span class="operator">&lt;</span> <span class="number">10</span> <span class="operator">}</span>
      <span class="operator">=&gt;</span> <span class="variable">message</span> <span class="operator">{</span> <span class="string">"This number (</span><span class="variable">$_</span><span class="string">) is not less than ten!"</span> <span class="operator">};</span>
</pre>
<p>This <code>message</code> block will be called when a value fails to pass the
<code>NaturalLessThanTen</code> constraint check.</p>
<p>
</p>
<h3><a name="can_i_turn_off_type_constraint_checking">Can I turn off type constraint checking?</a></h3>
<p>Not yet. This option may come in a future release.</p>
<p>
</p>
<h3><a name="my_coercions_stopped_working_with_recent_moose__why_did_you_break_it">My coercions stopped working with recent Moose, why did you break it?</a></h3>
<p>Moose 0.76 fixed a case where coercions were being applied even if the original
constraint passed. This has caused some edge cases to fail where people were
doing something like</p>
<pre>
    <span class="variable">subtype</span> <span class="string">'Address'</span><span class="operator">,</span> <span class="variable">as</span> <span class="string">'Str'</span><span class="operator">;</span>
    <span class="variable">coerce</span> <span class="string">'Address'</span><span class="operator">,</span> <span class="variable">from</span> <span class="string">'Str'</span><span class="operator">,</span> <span class="variable">via</span> <span class="operator">{</span> <span class="variable">get_address</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">)</span> <span class="operator">};</span>
</pre>
<p>This is not what they intended, because the type constraint <code>Address</code> is too
loose in this case. It is saying that all strings are Addresses, which is
obviously not the case. The solution is to provide a <code>where</code> clause that
properly restricts the type constraint:</p>
<pre>
    <span class="variable">subtype</span> <span class="string">'Address'</span><span class="operator">,</span> <span class="variable">as</span> <span class="string">'Str'</span><span class="operator">,</span> <span class="variable">where</span> <span class="operator">{</span> <span class="variable">looks_like_address</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">)</span> <span class="operator">};</span>
</pre>
<p>This will allow the coercion to apply only to strings that fail to look like an
Address.</p>
<p>
</p>
<h2><a name="roles">Roles</a></h2>
<p>
</p>
<h3><a name="why_is_build_not_called_for_my_composed_roles">Why is BUILD not called for my composed roles?</a></h3>
<p><code>BUILD</code> is never called in composed roles. The primary reason is that
roles are <strong>not</strong> order sensitive. Roles are composed in such a way
that the order of composition does not matter (for information on the
deeper theory of this read the original traits papers here
<a href="http://www.iam.unibe.ch/~scg/Research/Traits/">http://www.iam.unibe.ch/~scg/Research/Traits/</a>).</p>
<p>Because roles are essentially unordered, it would be impossible to
determine the order in which to execute the <code>BUILD</code> methods.</p>
<p>As for alternate solutions, there are a couple.</p>
<ul>
<li>
<p>Using a combination of lazy and default in your attributes to defer
initialization (see the Binary Tree example in the cookbook for a good
example of lazy/default usage <a href="../../../lib/Moose/Cookbook/Basics/Recipe3.html">the Moose::Cookbook::Basics::Recipe3 manpage</a>)</p>
</li>
<li>
<p>Use attribute triggers, which fire after an attribute is set, to
facilitate initialization. These are described in the <a href="../../../lib/Moose.html">the Moose manpage</a> docs,
and examples can be found in the test suite.</p>
</li>
</ul>
<p>In general, roles should not <em>require</em> initialization; they should
either provide sane defaults or should be documented as needing
specific initialization. One such way to &quot;document&quot; this is to have a
separate attribute initializer which is required for the role. Here is
an example of how to do this:</p>
<pre>
  <span class="keyword">package</span> <span class="variable">My::Role</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">Moose::Role</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">has</span> <span class="string">'height'</span> <span class="operator">=&gt;</span> <span class="operator">(</span>
      <span class="string">is</span>      <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span>
      <span class="string">isa</span>     <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">,</span>
      <span class="string">lazy</span>    <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
      <span class="string">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
          <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
          <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">init_height</span><span class="operator">;</span>
      <span class="operator">}</span>
  <span class="operator">);</span>
</pre>
<pre>
  <span class="variable">requires</span> <span class="string">'init_height'</span><span class="operator">;</span>
</pre>
<p>In this example, the role will not compose successfully unless the
class provides a <code>init_height</code> method.</p>
<p>If none of those solutions work, then it is possible that a role is
not the best tool for the job, and you really should be using
classes. Or, at the very least, you should reduce the amount of
functionality in your role so that it does not require initialization.</p>
<p>
</p>
<h3><a name="what_are_traits__and_how_are_they_different_from_roles">What are traits, and how are they different from roles?</a></h3>
<p>In Moose, a trait is almost exactly the same thing as a role, except
that traits typically register themselves, which allows you to refer
to them by a short name (&quot;Big&quot; vs &quot;MyApp::Role::Big&quot;).</p>
<p>In Moose-speak, a <em>Role</em> is usually composed into a <em>class</em> at
compile time, whereas a <em>Trait</em> is usually composed into an instance
of a class at runtime to add or modify the behavior of <strong>just that
instance</strong>.</p>
<p>Outside the context of Moose, traits and roles generally mean exactly
the same thing. The original paper called them traits, but Perl 6
will call them roles.</p>
<p>
</p>
<h3><a name="can_an_attribute_generated_method__e_g__an_accessor__satisfy_requires">Can an attribute-generated method (e.g. an accessor) satisfy requires?</a></h3>
<p>Yes, just be sure to consume the role <em>after</em> declaring your
attribute.  <a href="../../../lib/Moose/Manual/Roles.html#required_attributes">Required_Attributes in the Moose::Manual::Roles manpage</a> provides
an example:</p>
<pre>
  <span class="keyword">package</span> <span class="variable">Breakable</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">Moose::Role</span><span class="operator">;</span>
  <span class="variable">requires</span> <span class="string">'stress'</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">package</span> <span class="variable">Car</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">Moose</span><span class="operator">;</span>
  <span class="variable">has</span> <span class="string">'stress'</span> <span class="operator">=&gt;</span> <span class="operator">(</span> <span class="string">is</span>  <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span> <span class="operator">);</span>
  <span class="variable">with</span> <span class="string">'Breakable'</span><span class="operator">;</span>
</pre>
<p>If you mistakenly consume the <code>Breakable</code> role before declaring your
<code>stress</code> attribute, you would see an error like this:</p>
<pre>
  'Breakable' requires the method 'stress' to be implemented by 'Car' at...</pre>
<p>
</p>
<h2><a name="moose_and_subroutine_attributes">Moose and Subroutine Attributes</a></h2>
<p>
</p>
<h3><a name="why_don_t_subroutine_attributes_i_inherited_from_a_superclass_work">Why don't subroutine attributes I inherited from a superclass work?</a></h3>
<p>Currently when subclassing a module is done at runtime with the
<code>extends</code> keyword, but attributes are checked at compile time by
Perl. To make attributes work, you must place <code>extends</code> in a <code>BEGIN</code>
block so that the attribute handlers will be available at compile time,
like this:</p>
<pre>
  <span class="keyword">BEGIN</span> <span class="operator">{</span> <span class="variable">extends</span> <span class="string">qw/Foo/</span> <span class="operator">}</span>
</pre>
<p>Note that we're talking about Perl's subroutine attributes here, not
Moose attributes:</p>
<pre>
  <span class="keyword">sub</span><span class="variable"> foo : Bar</span><span class="operator">(</span>27<span class="operator">)</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
</pre>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Stevan Little &lt;<a href="mailto:stevan@iinteractive.com">stevan@iinteractive.com</a>&gt;</p>
<p>
</p>
<hr />
<h1><a name="copyright_and_license">COPYRIGHT AND LICENSE</a></h1>
<p>This software is copyright (c) 2011 by Infinity Interactive, Inc..</p>
<p>This is free software; you can redistribute it and/or modify it under
the same terms as the Perl 5 programming language system itself.</p>

</body>

</html>
