<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../../displayToc.js"></script>
<script language="JavaScript" src="../../../../tocParas.js"></script>
<script language="JavaScript" src="../../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../scineplex.css">
<title>Moose::Cookbook::Basics::Recipe1 - The B&lt;Point&gt; example.</title>
<link rel="stylesheet" href="../../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<script>writelinks('__top__',4);</script>
<h1><a>Moose::Cookbook::Basics::Recipe1 - The B&lt;Point&gt; example.</a></h1>
<p><a name="__index__"></a></p>


<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#version">VERSION</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#moose_objects_are_just_hashrefs">Moose Objects are Just Hashrefs</a></li>
	</ul>

	<li><a href="#conclusion">CONCLUSION</a></li>
	<li><a href="#footnotes">FOOTNOTES</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#copyright_and_license">COPYRIGHT AND LICENSE</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>Moose::Cookbook::Basics::Recipe1 - The (always classic) <strong>Point</strong> example.</p>
<p>
</p>
<hr />
<h1><a name="version">VERSION</a></h1>
<p>version 2.0205</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  <span class="keyword">package</span> <span class="variable">Point</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">Moose</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">has</span> <span class="string">'x'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">,</span> <span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">required</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
  <span class="variable">has</span> <span class="string">'y'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">,</span> <span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">required</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">sub</span><span class="variable"> clear </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>x<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>y<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
  <span class="operator">}</span>
</pre>
<pre>
  <span class="keyword">package</span> <span class="variable">Point3D</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">Moose</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">extends</span> <span class="string">'Point'</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">has</span> <span class="string">'z'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">,</span> <span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">required</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">after</span> <span class="string">'clear'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>z<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
  <span class="operator">};</span>
</pre>
<pre>
  <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
</pre>
<pre>
  <span class="comment"># hash or hashrefs are ok for the constructor</span>
  <span class="keyword">my</span> <span class="variable">$point1</span> <span class="operator">=</span> <span class="variable">Point</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span> <span class="string">y</span> <span class="operator">=&gt;</span> <span class="number">7</span><span class="operator">);</span>
  <span class="keyword">my</span> <span class="variable">$point2</span> <span class="operator">=</span> <span class="variable">Point</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span><span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span> <span class="string">y</span> <span class="operator">=&gt;</span> <span class="number">7</span><span class="operator">}</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$point3d</span> <span class="operator">=</span> <span class="variable">Point3D</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span> <span class="string">y</span> <span class="operator">=&gt;</span> <span class="number">42</span><span class="operator">,</span> <span class="string">z</span> <span class="operator">=&gt;</span> <span class="operator">-</span><span class="number">5</span><span class="operator">);</span>
</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This is the classic Point example. It is taken directly from the Perl
6 Apocalypse 12 document, and is similar to the example found in the
classic K&amp;R C book as well.</p>
<p>As with all Perl 5 classes, a Moose class is defined in a package.
Moose handles turning on <code>strict</code> and <code>warnings</code> for us, so all we
need to do is say <code>use Moose</code>, and no kittens will die.</p>
<p>When Moose is loaded, it exports a set of sugar functions into our
package. This means that we import some functions which serve as Moose
&quot;keywords&quot;. These aren't real language keywords, they're just Perl
functions exported into our package.</p>
<p>Moose automatically makes our package a subclass of <a href="../../../../lib/Moose/Object.html">the Moose::Object manpage</a>.
The <a href="../../../../lib/Moose/Object.html">the Moose::Object manpage</a> class provides us with a constructor that
respects our attributes, as well other features. See <a href="../../../../lib/Moose/Object.html">the Moose::Object manpage</a>
for details.</p>
<p>Now, onto the keywords. The first one we see here is <code>has</code>, which
defines an instance attribute in our class:</p>
<pre>
  <span class="variable">has</span> <span class="string">'x'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">,</span> <span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">required</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</pre>
<p>This will create an attribute named <a href="../../../../lib/pods/perlrun.html#x"><code>x</code></a>. The <code>isa</code> parameter says
that we expect the value stored in this attribute to pass the type
constraint for <code>Int</code> (1). The accessor generated for this attribute
will be read-write.</p>
<p>The <code>required =&gt; 1</code> parameter means that this attribute must be
provided when a new object is created. A point object without
coordinates doesn't make much sense, so we don't allow it.</p>
<p>We have defined our attributes; next we define our methods. In Moose,
as with regular Perl 5 OO, a method is just a subroutine defined
within the package:</p>
<pre>
  <span class="keyword">sub</span><span class="variable"> clear </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>x<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>y<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
  <span class="operator">}</span>
</pre>
<p>That concludes the <strong>Point</strong> class.</p>
<p>Next we have a subclass of <strong>Point</strong>, <strong>Point3D</strong>. To declare our
superclass, we use the Moose keyword <code>extends</code>:</p>
<pre>
  <span class="variable">extends</span> <span class="string">'Point'</span><span class="operator">;</span>
</pre>
<p>The <code>extends</code> keyword works much like <code>use base</code>. First, it will
attempt to load your class if needed. However, unlike <code>base</code>, the
<code>extends</code> keyword will <em>overwrite</em> any previous values in your
package's <code>@ISA</code>, where <code>use base</code> will <a href="../../../../lib/pods/perlfunc.html#push"><code>push</code></a> values onto the
package's <code>@ISA</code>.</p>
<p>It is my opinion that the behavior of <code>extends</code> is more intuitive.
(2).</p>
<p>Next we create a new attribute for <strong>Point3D</strong> called <code>z</code>.</p>
<pre>
  <span class="variable">has</span> <span class="string">'z'</span> <span class="operator">=&gt;</span> <span class="operator">(</span><span class="string">isa</span> <span class="operator">=&gt;</span> <span class="string">'Int'</span><span class="operator">,</span> <span class="string">is</span> <span class="operator">=&gt;</span> <span class="string">'rw'</span><span class="operator">,</span> <span class="string">required</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</pre>
<p>This attribute is just like <strong>Point</strong>'s <a href="../../../../lib/pods/perlrun.html#x"><code>x</code></a> and <code>y</code> attributes.</p>
<p>The <code>after</code> keyword demonstrates a Moose feature called &quot;method
modifiers&quot; (or &quot;advice&quot; for the AOP inclined):</p>
<pre>
  <span class="variable">after</span> <span class="string">'clear'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>z<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
  <span class="operator">};</span>
</pre>
<p>When <code>clear</code> is called on a <strong>Point3D</strong> object, our modifier method
gets called as well. Unsurprisingly, the modifier is called <em>after</em>
the real method.</p>
<p>In this case, the real <code>clear</code> method is inherited from <strong>Point</strong>. Our
modifier method receives the same arguments as those passed to the
modified method (just <code>$self</code> here).</p>
<p>Of course, using the <code>after</code> modifier is not the only way to
accomplish this. This <strong>is</strong> Perl, right? You can get the same results
with this code:</p>
<pre>
  <span class="keyword">sub</span><span class="variable"> clear </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">SUPER::clear</span><span class="operator">();</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>z<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
  <span class="operator">}</span>
</pre>
<p>You could also use another Moose method modifier, <code>override</code>:</p>
<pre>
  <span class="variable">override</span> <span class="string">'clear'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="variable">super</span><span class="operator">();</span>
      <span class="variable">$self</span><span class="operator">-&gt;</span>z<span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
  <span class="operator">};</span>
</pre>
<p>The <code>override</code> modifier allows you to use the <code>super</code> keyword to
dispatch to the superclass's method in a very Ruby-ish style.</p>
<p>The choice of whether to use a method modifier, and which one to use,
is often a question of style as much as functionality.</p>
<p>Since <strong>Point</strong> inherits from <a href="../../../../lib/Moose/Object.html">the Moose::Object manpage</a>, it will also inherit
the default <a href="../../../../lib/Moose/Object.html">the Moose::Object manpage</a> constructor:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$point1</span> <span class="operator">=</span> <span class="variable">Point</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span> <span class="string">y</span> <span class="operator">=&gt;</span> <span class="number">7</span><span class="operator">);</span>
  <span class="keyword">my</span> <span class="variable">$point2</span> <span class="operator">=</span> <span class="variable">Point</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span><span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span> <span class="string">y</span> <span class="operator">=&gt;</span> <span class="number">7</span><span class="operator">}</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$point3d</span> <span class="operator">=</span> <span class="variable">Point3D</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span> <span class="string">y</span> <span class="operator">=&gt;</span> <span class="number">42</span><span class="operator">,</span> <span class="string">z</span> <span class="operator">=&gt;</span> <span class="operator">-</span><span class="number">5</span><span class="operator">);</span>
</pre>
<p>The <code>new</code> constructor accepts a named argument pair for each
attribute defined by the class, which you can provide as a hash or
hash reference. In this particular example, the attributes are
required, and calling <code>new</code> without them will throw an error.</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$point</span> <span class="operator">=</span> <span class="variable">Point</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span> <span class="string">x</span> <span class="operator">=&gt;</span> <span class="number">5</span> <span class="operator">);</span> <span class="comment"># no y, kaboom!</span>
</pre>
<p>From here on, we can use <code>$point</code> and <code>$point3d</code> just as you would
any other Perl 5 object. For a more detailed example of what can be
done, you can refer to the
<em class="file">t/recipes/moose_cookbook_basics_recipe1.t</em> test file.</p>
<p>
</p>
<h2><a name="moose_objects_are_just_hashrefs">Moose Objects are Just Hashrefs</a></h2>
<p>While this all may appear rather magical, it's important to realize
that Moose objects are just hash references under the hood (3). For
example, you could pass <code>$self</code> to <code>Data::Dumper</code> and you'd get
exactly what you'd expect.</p>
<p>You could even poke around inside the object's data structure, but
that is strongly discouraged.</p>
<p>The fact that Moose objects are hashrefs means it is easy to use Moose
to extend non-Moose classes, as long as they too are hash
references. If you want to extend a non-hashref class, check out
<code>MooseX::InsideOut</code>.</p>
<p>
</p>
<hr />
<h1><a name="conclusion">CONCLUSION</a></h1>
<p>This recipe demonstrates some basic Moose concepts, attributes,
subclassing, and a simple method modifier.</p>
<p>
</p>
<hr />
<h1><a name="footnotes">FOOTNOTES</a></h1>
<dl>
<dt><strong><a name="16" class="item">(1)</a></strong></dt>

<dd>
<p>Moose provides a number of builtin type constraints, of which <code>Int</code>
is one. For more information on the type constraint system, see
<a href="../../../../lib/Moose/Util/TypeConstraints.html">the Moose::Util::TypeConstraints manpage</a>.</p>
</dd>
<dt><strong><a name="24" class="item">(2)</a></strong></dt>

<dd>
<p>The <code>extends</code> keyword supports multiple inheritance. Simply pass all
of your superclasses to <code>extends</code> as a list:</p>
<pre>
  <span class="variable">extends</span> <span class="string">'Foo'</span><span class="operator">,</span> <span class="string">'Bar'</span><span class="operator">,</span> <span class="string">'Baz'</span><span class="operator">;</span>
</pre>
</dd>
<dt><strong><a name="34" class="item">(3)</a></strong></dt>

<dd>
<p>Moose supports using instance structures other than blessed hash
references (such as glob references - see <a href="../../../../MooseX/GlobRef.html">the MooseX::GlobRef manpage</a>).</p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<dl>
<dt><strong><a name="method_modifiers" class="item">Method Modifiers</a></strong></dt>

<dd>
<p>The concept of method modifiers is directly ripped off from CLOS. A
great explanation of them can be found by following this link.</p>
<p><a href="http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html">http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html</a></p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Stevan Little &lt;<a href="mailto:stevan@iinteractive.com">stevan@iinteractive.com</a>&gt;</p>
<p>
</p>
<hr />
<h1><a name="copyright_and_license">COPYRIGHT AND LICENSE</a></h1>
<p>This software is copyright (c) 2011 by Infinity Interactive, Inc..</p>
<p>This is free software; you can redistribute it and/or modify it under
the same terms as the Perl 5 programming language system itself.</p>

</body>

</html>
